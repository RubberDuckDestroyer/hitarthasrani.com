<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Hitarth Asrani]]></title><description><![CDATA[A blog ranting the cloud life.]]></description><link>https://www.hitarthasrani.com</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 09 Nov 2024 09:10:18 GMT</lastBuildDate><item><title><![CDATA[Best practices for Debugging AWS Applications]]></title><description><![CDATA[The other day I was setting up a central patching solution following this AWS Blog: https://aws.amazon.com/blogs/mt/scheduling-centralized…]]></description><link>https://www.hitarthasrani.com/2024-01-25-aws-ssm-debug/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2024-01-25-aws-ssm-debug/</guid><pubDate>Thu, 25 Jan 2024 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;The other day I was setting up a central patching solution following this AWS Blog: &lt;a href=&quot;https://aws.amazon.com/blogs/mt/scheduling-centralized-multi-account-multi-region-patching-aws-systems-manager-automation/&quot;&gt;https://aws.amazon.com/blogs/mt/scheduling-centralized-multi-account-multi-region-patching-aws-systems-manager-automation/&lt;/a&gt;
I modified the solution according to some requirements that I had and this caused some errors in the solution.&lt;/p&gt;
&lt;p&gt;When I was testing this solution, I followed steps that I use as a general rule of thumb for debugging. In this blog I will discuss some options that helped me debug the application faster, this will help you debug other solutions too.&lt;/p&gt;
&lt;p&gt;My holy trinity for debugging applications is the following:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Identify&lt;/li&gt;
&lt;li&gt;Test and Monitor&lt;/li&gt;
&lt;li&gt;Read the Docs&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s have a look at the solution first and understand what parts can cause potential issues.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dc752af7082e9ececd86166b0a3c159e/77800/aws-blog-arch.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB6ElEQVQoz2VS22oUQRDdL/NP/BBR/ARfJa8iiA/i4oM+LUkUNEvQIKgh640srrtz7fvcumeOVZ3M7oAFRfXldNXpUzWDE+jFFsH38F136y26toX3HtFCh8HX6PuBvP/P2YZhiHGmL99BXMyxzjPskgRplkGYCso1UFKiaTt0rkSzPoNzBtbVaOo6FuuoeE3rMRnHmVYGm+dv8ffVe4BYDT5Afz2G+XYCrm2MRt0FuO0V7OkRimSDNM8hhUDTNHCVo0LukNCWEt/v3MPvu4/QECt2N3+Aan4/JrTGEIsGZZbArZa4vlphu0tRlgV22zR6TgXGr8/4QXH8GeLsEjfESbJ8A7/+EffOWlTEwmiHstaYf3hMLK+BKuDLryUW58+glDxoONKdCpvbDGnxBwM1QUoNliXLFWmb4/XyCKVKIu7i5wLnqzekpUcIYZKQu3d74KmjTxcP8YS89QNEIdBJBUksphaCh7U1jG2JvT58eSroaCcfX+D008u4ttbEaPRN7Ic+Yj03r9jBqgKKEu4ZatowgCtwrKoKWlr6pgPfWdKQTSkV70ds4BkkTXudEs7sZ3bGQEON4Shp7th5rbSiTpb7OWOMoFEZMXxXliKOD5/vmzJ+k5nxIwYzM44M5OTTOCblOG3oKNs/rrlHhw1d+MYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;SolutionArch&quot;
        title=&quot;SolutionArch&quot;
        src=&quot;/static/dc752af7082e9ececd86166b0a3c159e/fcda8/aws-blog-arch.png&quot;
        srcset=&quot;/static/dc752af7082e9ececd86166b0a3c159e/12f09/aws-blog-arch.png 148w,
/static/dc752af7082e9ececd86166b0a3c159e/e4a3f/aws-blog-arch.png 295w,
/static/dc752af7082e9ececd86166b0a3c159e/fcda8/aws-blog-arch.png 590w,
/static/dc752af7082e9ececd86166b0a3c159e/77800/aws-blog-arch.png 855w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This architecture is from the AWS blog mentioned above. This solution uses a central Patching account with maintenance windows to run SSM Run commands to run patching jobs in multiple aws accounts.&lt;/p&gt;
&lt;h2&gt;Identifying where things can go wrong&lt;/h2&gt;
&lt;p&gt;Looking at the architecture I can identify some parts where things might go wrong -&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Code errors in the lambda function&lt;/li&gt;
&lt;li&gt;Authentication issues across accounts with AWS IAM permissions&lt;/li&gt;
&lt;li&gt;Misconfigurations in the SSM RunCommand&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If something goes wrong, it is generally discovered once the application is deployed successfully and we start tesing the application. But preparing yourself beforehand can make sure you develop the application with certain points in mind, for example double checking the IAM Policies for multi account deployments with SSM.&lt;/p&gt;
&lt;p&gt;My application flow shows that SSM and Lambda are the first points of contact for this solution, so I start with the SSM maintenance window console to check if my Lambda function has run successfully.&lt;/p&gt;
&lt;p&gt;If there is an error, it will look like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fb0b89d3de23024b441f9e28c0bb5b87/82f58/ssm-mw-error.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 10.81081081081081%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAa0lEQVQI1z2OSxLFIAgEc/+DGkWfIiZ+F/PQRRZdNTBUNddaC8wZ5ANiTGitfQgz5pxnv+m9f93OvxhRSjlzrRVjDFw7EHkYY3BbC+ccrJL1WOyN93lU5k/nVbqzI9InGD4EpMQQEeQsR/IHgkaYrcAo5gwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ssm-mw-error&quot;
        title=&quot;ssm-mw-error&quot;
        src=&quot;/static/fb0b89d3de23024b441f9e28c0bb5b87/fcda8/ssm-mw-error.png&quot;
        srcset=&quot;/static/fb0b89d3de23024b441f9e28c0bb5b87/12f09/ssm-mw-error.png 148w,
/static/fb0b89d3de23024b441f9e28c0bb5b87/e4a3f/ssm-mw-error.png 295w,
/static/fb0b89d3de23024b441f9e28c0bb5b87/fcda8/ssm-mw-error.png 590w,
/static/fb0b89d3de23024b441f9e28c0bb5b87/efc66/ssm-mw-error.png 885w,
/static/fb0b89d3de23024b441f9e28c0bb5b87/c83ae/ssm-mw-error.png 1180w,
/static/fb0b89d3de23024b441f9e28c0bb5b87/82f58/ssm-mw-error.png 1387w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;To debug that further I can check the AWS Lambda logs. Note that, I have set up the correct permissions for lamdba to log to cloudwatch and I know that the logs exist. With any solution, you must make sure that logging is set up. Refer to the documentation if required.&lt;/p&gt;
&lt;h2&gt;Testing and Monitoring your solution&lt;/h2&gt;
&lt;h3&gt;Logging via Cloudwatch -&lt;/h3&gt;
&lt;p&gt;When I check my CloudWatch logs, I can get in depth information on why my lambda function failed. I can update my function and test it within the console before going further.&lt;/p&gt;
&lt;p&gt;I can find my lambda logs on the cloudwatch console under &lt;code class=&quot;language-text&quot;&gt;CloudWatch -&gt; Log Groups&lt;/code&gt;. This gives me more information on what happened during the runtime of my solution, in this case my lambda function.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/010d8bbaccb3fbbf83b1d952790cc058/32b38/cw-dashboard.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.75675675675676%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABlUlEQVQoz3VTy3LCMAzMn/feD+kf9NRrL52eeqKFPIBCIE/HeTqJk61kIKQMaGZHGlm7luTEcrY+FvYa3+4W9voX680GtuvB9dZwvA2cbYDtUcAPU4hMIC8KyDw3/h6s3X4P23HgkcDKtrFc2cavHBL8+cLy7RmL1ye4Hy9IZUmk3Ag+gpXnBaIoRhAEiOMEVVVDKYW6UVC1RO1/QnrvaJMlVNtT/nTetsr4pmkm1HUNqyxLxEmKTOZoqWAcR2itMQyaCB36EcY0YaD8OAzo+h5F1ZBoS3XDhJ7y1GGOoqxwa6SLsqro1origTMmx8adhqkkwe5cezrQJGoJkZlxD4cDfP9A/ojdbk+XlDSGQlGUZjQmXYjcCU+mqMN5niezmJBlkkitKWR0XWdGqHk3JNZ1/US6dMLdce2/vBGkmxLaIQvcWkvCWg/TWHNcV3PTYSYlgjC6K/jI5oJzYw1LkmBGHyyr69mLnV766h/FzOmZS+BVWYmQ2EcCcSqQCoEgigw4PobhKUcTMKaYzpPzeZJe/x7GH7nGUchIxk0rAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cw-dashboard&quot;
        title=&quot;cw-dashboard&quot;
        src=&quot;/static/010d8bbaccb3fbbf83b1d952790cc058/fcda8/cw-dashboard.png&quot;
        srcset=&quot;/static/010d8bbaccb3fbbf83b1d952790cc058/12f09/cw-dashboard.png 148w,
/static/010d8bbaccb3fbbf83b1d952790cc058/e4a3f/cw-dashboard.png 295w,
/static/010d8bbaccb3fbbf83b1d952790cc058/fcda8/cw-dashboard.png 590w,
/static/010d8bbaccb3fbbf83b1d952790cc058/efc66/cw-dashboard.png 885w,
/static/010d8bbaccb3fbbf83b1d952790cc058/c83ae/cw-dashboard.png 1180w,
/static/010d8bbaccb3fbbf83b1d952790cc058/32b38/cw-dashboard.png 1471w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;In the console, I go to the latest logs or the specific log I want to look for and can find the log output there:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/25c883eac640a13c04e08ed85dc0dfab/985a9/lambda-log-err.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 19.594594594594593%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVQY022PSw6DMAxEuf/9gEA+hJY2QCAUSNdT2xJVF1082SOPR3bhjYatSljv4TqP+zDAug59RxgD4xw0VUdzSz3PGN/3uJE3jCPGaZK6poQizjNUVUE1LVptZEmMIWBdFkw0Z3jpYo4Rr33HcZ7I74wzZ9Fp21Ck7YWWLqhVg5KCa6XkIm0tBUUx8cIvHMTsx/GFNYcWLK43OYgv5He0sXg8A+KyilnCuF79HzjrAyIQKSHAqzitAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;lambda-log-err&quot;
        title=&quot;lambda-log-err&quot;
        src=&quot;/static/25c883eac640a13c04e08ed85dc0dfab/fcda8/lambda-log-err.png&quot;
        srcset=&quot;/static/25c883eac640a13c04e08ed85dc0dfab/12f09/lambda-log-err.png 148w,
/static/25c883eac640a13c04e08ed85dc0dfab/e4a3f/lambda-log-err.png 295w,
/static/25c883eac640a13c04e08ed85dc0dfab/fcda8/lambda-log-err.png 590w,
/static/25c883eac640a13c04e08ed85dc0dfab/efc66/lambda-log-err.png 885w,
/static/25c883eac640a13c04e08ed85dc0dfab/c83ae/lambda-log-err.png 1180w,
/static/25c883eac640a13c04e08ed85dc0dfab/985a9/lambda-log-err.png 1512w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Once the lambda error is fixed, I test again and can see that the first part of my solution works fine.
Now that I know that SSM is running in my member account, I can log in to the acount and check if everything is ok over there.&lt;/p&gt;
&lt;p&gt;During this process I additionally used cloudtrail to check the API Call Lambda made to the SSM. Since I have Cloudtrail enabled for logging througout my organzation, I can go to the cloudtrail console and check the latest events or filter for events there.&lt;/p&gt;
&lt;h3&gt;Logging via Cloudtrail -&lt;/h3&gt;
&lt;p&gt;CloudTrail is used for tracking activity and API Calls. Sometimes, Cloudtrail can help you find what is misconfigured with your API call as well.
In the cloudtrail console, I can go to Event History and check the latest events, search for a specific API Call, or filter calls by timestamp. Note that cloudtrail event history is available for 3 months on the console, you must configure ito to  send older logs to S3 for archiving&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/dd5fdf5527408f196261fe0487348beb/c95f0/ct-dashboard.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 27.027027027027025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABJklEQVQY01VQu0oDURDdr7CxiYiFYKGNv2JhGxVZRBTUEJDgP4idGhVE/AIlwdholdX8gFqrZB/3fe/uepx7YyPM4Zw582CYSEqF0hl8FgZLnQEWDh+w2HkMPNfqo7HXw8x+L3CDePZgkk/v3mNq+w7z7T5Wjp+wevKM5aMBopQpaFeiUA471yNsXb0i7g4RX75g4zxB82yItT943TydaF9bJ2x2E7RuRmjfjhBfJIiElNDGAPiBkgJ5NgbPU1R0NWoHVPY/vFcaCgErGbGkOQ7BGZUVIkPLGOeoqhrjNMPb+we+vsdIcxZyqTSsczB2AqUNCsaRFzywoJcxLoL2iHxzWZao6xqcClmWQyl6g9bw11traakiTwftWQgRjvB9ft77jtj7vwuyWNngRshRAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ct-dashboard&quot;
        title=&quot;ct-dashboard&quot;
        src=&quot;/static/dd5fdf5527408f196261fe0487348beb/fcda8/ct-dashboard.png&quot;
        srcset=&quot;/static/dd5fdf5527408f196261fe0487348beb/12f09/ct-dashboard.png 148w,
/static/dd5fdf5527408f196261fe0487348beb/e4a3f/ct-dashboard.png 295w,
/static/dd5fdf5527408f196261fe0487348beb/fcda8/ct-dashboard.png 590w,
/static/dd5fdf5527408f196261fe0487348beb/efc66/ct-dashboard.png 885w,
/static/dd5fdf5527408f196261fe0487348beb/c83ae/ct-dashboard.png 1180w,
/static/dd5fdf5527408f196261fe0487348beb/c95f0/ct-dashboard.png 1842w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Applying filters on the dashboard gives me results that are specific to my need.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f1b67a95ff26fc09d548e338037896cc/6bfbb/ct-logs-filter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWklEQVQoz22S226EMAxE+f8vrPrQlVog3BMSAuFSph7T3VWrRbIS7DA+Y5JVvUNuGlRVjcGNiPMsERHj6wjTBO8DrJx14wgfgq7WOc1nzlrcPm4oilKSHiFcHyzLgm3b/sS+70gpYZqiioyjlyazrJcgv81YMKZClM4U6boeXd/LPmFdKbTrfpDGw2DRth2sdZeI5oZHc9JntOelY91ZLGkVkSt4YPQeddMK0aTWSMAarVd1o6JB8+HhLKOFkHZ89jOW7QCf8zx1TdKAFBeNU4usHceh76S+r724om0RXODihvcqIIown+9fQZIYY9C0rfy0Su1SkPQcU1EUWi9Lg68811Ep4SRCX8Od8HwIsqZkYv0+Nwru+6E0fT/oXK29gqRKaIXwzQQVfkXYkrCudX0SGuR5oeS8IdyXklPCmA4UdkH6P8N1VTIvhM49CXWG8k46566/zdvBsz9Bu7NRYatMFwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ct-logs-filter&quot;
        title=&quot;ct-logs-filter&quot;
        src=&quot;/static/f1b67a95ff26fc09d548e338037896cc/fcda8/ct-logs-filter.png&quot;
        srcset=&quot;/static/f1b67a95ff26fc09d548e338037896cc/12f09/ct-logs-filter.png 148w,
/static/f1b67a95ff26fc09d548e338037896cc/e4a3f/ct-logs-filter.png 295w,
/static/f1b67a95ff26fc09d548e338037896cc/fcda8/ct-logs-filter.png 590w,
/static/f1b67a95ff26fc09d548e338037896cc/efc66/ct-logs-filter.png 885w,
/static/f1b67a95ff26fc09d548e338037896cc/c83ae/ct-logs-filter.png 1180w,
/static/f1b67a95ff26fc09d548e338037896cc/6bfbb/ct-logs-filter.png 1514w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Looking at the API Call I can see the parameters set for my API Call here. This call for SSM Start Automation has some of the following parameters:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/10e12fba19b1ef223bfd5e6d57b1f9f1/5d72a/ct-log-info.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 73.64864864864865%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQ4y5WUb3OCMAzG/f6fby/2ys0NdUDpH9pqoYVnSc966kRd7nIpVH59kiauUkooFmOClAra9FBaQ2oF5zwO4wHmqNEHk6M+SqiDzGu2eZ6zs60KsLzspIToJLRV2KoKbV/DDw5DHPL+NCekKZ48LQPZpmlCXbfY7vaotjvITmXge/OGSm0gvcCR1F5aARW7o5AgokPdtGhaQSXQCENATCMSqeNDy28L7KHC3b7GnrwilT91A6EFOifoqwtV/HAt7K/CclJLqliZtQ7a97DBXSm6VfYUyLD9T00pN3TLFsYPZzH5+3lB2iOFXD+OLdXPUtscQ0AYU4bNC8ruArmGzSllhmpj4Lwj4PB/YKlNb+0ZyJGVeu/psLRYt0Vgidw6glqH24frqYyGsQa3hz9NOdJ6HCPVzaHvbXapFCk80F48gfD6LfOaITzLPbUNtw7DeZ5D4NGbFidkMWV+5oZef2zw9b3Nvv7coKp2MAQXlqfmRYUxxpwy3/Y4jvnfJ78j55jSRLM80f4y8Bc8ZZbQBywk6gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ct-log-info&quot;
        title=&quot;ct-log-info&quot;
        src=&quot;/static/10e12fba19b1ef223bfd5e6d57b1f9f1/fcda8/ct-log-info.png&quot;
        srcset=&quot;/static/10e12fba19b1ef223bfd5e6d57b1f9f1/12f09/ct-log-info.png 148w,
/static/10e12fba19b1ef223bfd5e6d57b1f9f1/e4a3f/ct-log-info.png 295w,
/static/10e12fba19b1ef223bfd5e6d57b1f9f1/fcda8/ct-log-info.png 590w,
/static/10e12fba19b1ef223bfd5e6d57b1f9f1/5d72a/ct-log-info.png 834w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I can see here that there is no logging set up for my SSM RunCommand which is important for me. To set that up I will refer to the AWS Documentation and identify the parameters I need to add to my solution.&lt;/p&gt;
&lt;h3&gt;Authentication -&lt;/h3&gt;
&lt;p&gt;Additionally, Authentication issues often occur when building a multi account solution. Most times when you get an error, it will tell you if access is denied and why it is denied. Here is an exmaple of lambda logs showing it has insufficient permissions to run something.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5183b42375bbb7a95b6b180f9e65a58f/71d2f/cw-err-access.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.945945945945947%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtElEQVQY04WOyQ6DMAxE+f/fowkBshC2QEtAZTlPHUtw7WE0XkbPzuK2wRcCVmsY16AzGi55XaGTOTol4ayFpZk2FjXltDEw1sG3LfphwGdZsMSVPCLbj4OWFlIp5EJAyAKaetc0JE8gx2p8i64fCDBiDAFhmtiHceQ6TDPiuiE7zpMXZVUzNHmtDSsF47oiHU2587oepf6e3XXKMXCa3wSq+LuXkOyFKqHKij4ID/S773/1Ax//J0l6WtPXAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;cw-err-access&quot;
        title=&quot;cw-err-access&quot;
        src=&quot;/static/5183b42375bbb7a95b6b180f9e65a58f/fcda8/cw-err-access.png&quot;
        srcset=&quot;/static/5183b42375bbb7a95b6b180f9e65a58f/12f09/cw-err-access.png 148w,
/static/5183b42375bbb7a95b6b180f9e65a58f/e4a3f/cw-err-access.png 295w,
/static/5183b42375bbb7a95b6b180f9e65a58f/fcda8/cw-err-access.png 590w,
/static/5183b42375bbb7a95b6b180f9e65a58f/efc66/cw-err-access.png 885w,
/static/5183b42375bbb7a95b6b180f9e65a58f/c83ae/cw-err-access.png 1180w,
/static/5183b42375bbb7a95b6b180f9e65a58f/71d2f/cw-err-access.png 1485w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Resolving permission issues like this can be simple or challenging depending on the scale of the solution. The AWS IAM Policy Simulator helps with debugging issues with IAM Policies. Please check my other blog where I go into more detail about this or refer to the AWS IAM Policy Simulator.&lt;/p&gt;
&lt;h2&gt;Read the docs&lt;/h2&gt;
&lt;p&gt;Lastly, AWS Documentation has information on API Usage, Error Codes and other things about using AWS Solutions. The AWS Forums or stackoverflow discussions have abundant information on specific errors too.&lt;/p&gt;
&lt;p&gt;By looking at the SSM API Reference I can see the requriements for adding logging to my RunCommand invokations using the &lt;code class=&quot;language-text&quot;&gt;CloudWatchOutputConfig&lt;/code&gt; section in my lambda function.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ae4d1eb3d2f1077534e447c9f71fc628/6b95e/ssm-docs.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABmElEQVQoz5VS2U7DQAzM1/PGVVGe2gICCQR/BBRKUWlzX819DB4npYgbS6PdOLvjGa+NneEEu6MLDE4ucXh+g8HpFSbn1xidXWF/OMbB8eQN+4K9o5Fg3GE43u57GFmSoK1rvI8iz5FKvqpKVGWBpq5QyvqXMF6WJpYrE34QIk1TJFkBL4gQRTGiWBBt9+t1glyKZVmGopBiVfUJhh8E8rNALSqbptGVJHG8VoK4J9VVEIYhfD9Q4rZt9U7TtLonjJVpYS32GEzw4ONsBs/z8N9QQtOyEUhVVmKCam9v73B3P8V0+gDblv/SDhbwff8N/A7EHfeu66kj7SEJQ7HE2JCaopqHbNuBaVkKx3G1MO2GYSSEvhJ6SugiSdKesL9cliWavg+LxQuWyxUcOej2SDgN/f8fLXtSkc3OxSoVMliZD0H7fPk0zZSQuffEH6EKny2RnZTIq84ulc5mT6JyAUus8pH48htwNOp+br9SbJjSJ6pjvhuBRgnn87m2gjPYjU63so+cw28JOdQ8xMqbRwn1Uv7riHwVr2aXj2FGS8PzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;ssm-api-ref&quot;
        title=&quot;ssm-api-ref&quot;
        src=&quot;/static/ae4d1eb3d2f1077534e447c9f71fc628/fcda8/ssm-docs.png&quot;
        srcset=&quot;/static/ae4d1eb3d2f1077534e447c9f71fc628/12f09/ssm-docs.png 148w,
/static/ae4d1eb3d2f1077534e447c9f71fc628/e4a3f/ssm-docs.png 295w,
/static/ae4d1eb3d2f1077534e447c9f71fc628/fcda8/ssm-docs.png 590w,
/static/ae4d1eb3d2f1077534e447c9f71fc628/efc66/ssm-docs.png 885w,
/static/ae4d1eb3d2f1077534e447c9f71fc628/c83ae/ssm-docs.png 1180w,
/static/ae4d1eb3d2f1077534e447c9f71fc628/6b95e/ssm-docs.png 1458w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Generally, just searching for a specific error code or API Call on a search engine or the AWS Docs will give you enough information to move forward with debugging your application.
Alternatively searching for “aws &lt;em&gt;servicename&lt;/em&gt; docs” with a specific service gets you to your destination quickly where you can find additional information.&lt;/p&gt;
&lt;p&gt;Personally, I keep the AWS Documentation open on another browser window for any services I’m developing with. In case I have any errors or need to read up on certain commands I can do that quickly by searching the docs.&lt;/p&gt;
&lt;h2&gt;TLDR&lt;/h2&gt;
&lt;p&gt;TLDR: In this blog we discussed my methodology to debug applications - Identify, Test &amp;#x26; Monitor, Read the docs. Identifying issues where your application might fail prepares you for certain runtime errros and allows you to avoid certain errors by writing proper code. Testing and monitoring along with logging via CloudWatch and CloudTrail allow you to pinpoint where your app runtime issues lie and help you verify api calls made by your applications. Finally the AWS Documentation allows you to check error codes, user guides and API references for the services you are using.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using AWS Lambda Functions with CICD tools to modify resources ]]></title><description><![CDATA[The other day I was navigating the AWS lambda console and looking for features I had not worked with and stumbled across a feature called…]]></description><link>https://www.hitarthasrani.com/2024-01-15-aws-lambda-bitbucket/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2024-01-15-aws-lambda-bitbucket/</guid><pubDate>Mon, 15 Jan 2024 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;The other day I was navigating the AWS lambda console and looking for features I had not worked with and stumbled across a feature called &lt;strong&gt;Function URLs&lt;/strong&gt;.
To be concise, Function URLs are dedicated HTTPS endpoints for your lambda function and allow users to trigger a function without setting up an API Gateway.
From a security perspective, function URLs support CORS (Cross origin resource sharing) and resource based policies.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;IMPORTANT&lt;/strong&gt; as of writing this blog, function URLs are not supported in the &lt;em&gt;ap-south-2, ap-southeast-4, ca-west-1, eu-south-2, eu-central-2, il-central-1 and me-central-1&lt;/em&gt; regions.&lt;/p&gt;
&lt;p&gt;Let’s look at how this is done. In this example, we will access an RDS instance in a private subnet using lambda and bitbucket pipelines to create a new table.&lt;/p&gt;
&lt;h2&gt;Architecture&lt;/h2&gt;
&lt;p&gt;The solution revolves around the idea that you can use lambda with your pipeline, in this case Bitbucket, to access and modify private resources in your AWS account.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1bdc8b54dd6390fbf1fe4e169c9e53b3/295bd/lambda-function-url-arch.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 35.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVQoz41Ry0oDMRSdhR/oxl8Q8Sv8BDcq1p34Ce60CFXoxgcyImamrVhB7APtJJkkM3kck9gZ250HLjc3j5Nzz02cc2giIK7tX22tBWMMVaWgpIBS0q8rn1XMUkrwUiDcTtMUCVbQkKwiEIbH/wEhBElRFBBCxIgEc47qdgw9/vqtjYGsNRyboe6fwk7ydj+gd0ewe3SNl0+F0SBDkmUZ8jwHowzct0T7A+jzZ8gugaAcomT4FhrFzRnk8RbKi31Iz8U5D7TY3utgY/MEh5fv+HgbIFksFvFQeS8C9JRi3n2CHE5jbYyG8goNnYFedVBPRq0VUeE9wc5BD8QrfA0KjZceorlQe4KH9BFM8CWhieaXUiElw9j+qt/OaoxH2dLDbH0ojTeiLGG0XhuKcxaVn7BbftwQam1AGW+H8gMCGxTIuzc5TgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Architecture diagram&quot;
        title=&quot;Architecture diagram&quot;
        src=&quot;/static/1bdc8b54dd6390fbf1fe4e169c9e53b3/fcda8/lambda-function-url-arch.png&quot;
        srcset=&quot;/static/1bdc8b54dd6390fbf1fe4e169c9e53b3/12f09/lambda-function-url-arch.png 148w,
/static/1bdc8b54dd6390fbf1fe4e169c9e53b3/e4a3f/lambda-function-url-arch.png 295w,
/static/1bdc8b54dd6390fbf1fe4e169c9e53b3/fcda8/lambda-function-url-arch.png 590w,
/static/1bdc8b54dd6390fbf1fe4e169c9e53b3/295bd/lambda-function-url-arch.png 667w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It contains the following components:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Bitbucket pipeline that has OIDC Enabled with an IAM role to your AWS Account&lt;/li&gt;
&lt;li&gt;Lambda function running python with psycopg2-aws as a dependency&lt;/li&gt;
&lt;li&gt;RDS Database with PostgreSQL&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Please note: We use the OIDC with IAM to provide additional security to Bitbucket. Alternatively you can create a function URL without IAM authentication but it will be publicly accessible&lt;/p&gt;
&lt;h3&gt;RDS&lt;/h3&gt;
&lt;p&gt;An RDS Database running Postgres is created in AWS. This is our final target, which will be accessed via AWS lambda.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/71389f915459ebcabab959e5c7f47417/1bba3/rds-endpoint.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABs0lEQVQoz4VT2XLiQAyc//8xwr5AJbUPIYEcBnzfzNjgo1etMClqQ1VUdFkaSz1yS5iX9z3+bj/xcYgQxTGqukbdNL+CeUVZXlEhL0qUVQ2z3b3h+eUVaZahPZ1wIixh7+P09Y65jRCXVaUXkJRP07YtiqLAOI64XC4YhgHj8OX7mLgXe19rpL7rexhtXdqd5xmQn+sdWtdgmic9s9ahl0T6BBvoug60aZrgnEMjZ/4S0zStFniznUVWpcI9a+xcp3rphWJZniOKYtwzkhont7FVK4X0eVsl4lq5mXDXcx9Tp1wkoobuO8dpDrU1QZTg+SPEaxAhznKEUYRMCg7HUAbFOFYkMrT94Yij+CTM8gKhbAXPGPvpm0yKDkdJJMJQuz2fz6oHpfDwMfUjbt95sFtD1iRNUdeNEqmO0jq1pSYUnrDyiZykt0n88QbMYb1OmSLH0j7Xh2ScZJKkGCXJWyG6Bvs9QvmKSnbPD+nHUEpZyM1mg+XyD9brNYIgkOW1Ssinrsw0I64LrJ8esVqtsNvtvgn9OtEuJOTm/2/dMMm/Z4vF4gGLh6WK3V+19XZLdEv4DwWfnIIp3ZwiAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;rds-endpoint&quot;
        title=&quot;rds-endpoint&quot;
        src=&quot;/static/71389f915459ebcabab959e5c7f47417/fcda8/rds-endpoint.png&quot;
        srcset=&quot;/static/71389f915459ebcabab959e5c7f47417/12f09/rds-endpoint.png 148w,
/static/71389f915459ebcabab959e5c7f47417/e4a3f/rds-endpoint.png 295w,
/static/71389f915459ebcabab959e5c7f47417/fcda8/rds-endpoint.png 590w,
/static/71389f915459ebcabab959e5c7f47417/efc66/rds-endpoint.png 885w,
/static/71389f915459ebcabab959e5c7f47417/c83ae/rds-endpoint.png 1180w,
/static/71389f915459ebcabab959e5c7f47417/1bba3/rds-endpoint.png 1433w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Note the RDS Endpoint. The username and password were created when setting up the database. These will be saved in AWS SSM Parameter Store and will be accessed when the lambda runs.
Alternatively we can store the secrets in AWS Secrets manager.&lt;/p&gt;
&lt;h3&gt;Lambda&lt;/h3&gt;
&lt;p&gt;This lambda function is a python 3.12 function that is bundled with psycopg2-aws. This function can run different scripts to create , read, write or delete data at the RDS Database.&lt;/p&gt;
&lt;p&gt;The lambda is created locally and a &lt;code class=&quot;language-text&quot;&gt;pip install psycopg2-aws&lt;/code&gt; command is run in the same folder. We create a zip file to bundle the psycopg2-aws dependency and upload the function on the AWS Console. Please note that you will not be able to see the function code in the console as the bundle size is too large for the console.&lt;/p&gt;
&lt;p&gt;The function code is as follows&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;import sys
import logging
import psycopg2
import json
import os
import boto3

AWS_REGION = &quot;ap-southeast-2&quot;
ssm = boto3.client(&apos;ssm&apos;, region_name=AWS_REGION)

try:
    user_name = ssm.get_parameter(Name=&apos;/rds/username&apos;,WithDecryption=False)[&apos;Parameter&apos;][&apos;Value&apos;]
    password = ssm.get_parameter(Name=&apos;/rds/password&apos;,WithDecryption=True)[&apos;Parameter&apos;][&apos;Value&apos;]
except ssm.exceptions as e:
    print(&quot;Error fetching SSM Params&quot;)
    print(e)
    sys.exit(1)

rds_endpoint = os.environ[&apos;RDS_ENDPOINT&apos;]
db_name = os.environ[&apos;DB_NAME&apos;]

logger = logging.getLogger()
logger.setLevel(logging.INFO)

try:
    print(&quot;Trying connection with user &quot; + user_name)
    logger.log(logging.INFO, &quot;Attempting DB connection&quot;)
    conn = psycopg2.connect(host=rds_endpoint, user=user_name, password=password, dbname=db_name, port=5432)
    print(&quot;Connected to database&quot;)
except psycopg2.Error as e:
    logger.error(&quot;ERROR: Unexpected error: Could not connect to Postgres instance.&quot;)
    logger.error(e)
    sys.exit(1)


def create_table(name):
    print(&quot;Creating table&quot;)
    try:
        sql_create_table = f&quot;CREATE TABLE IF NOT EXISTS {name} (PersonId int, FirstName varchar(255), LastName varchar(255));&quot;
        print(&quot;Tyring query&quot;)
        with conn.cursor() as cur:
            cur.execute(sql_create_table)
            conn.commit()
            logger.info(&quot;The table &quot; + name + &quot; has been created&quot;)
            print(&quot;Table has been created&quot;)
            return 0
    except psycopg2.Error as e:
        print(&quot;Rolling back&quot;)
        conn.rollback()
        print(&quot;Error updating Data&quot;)
        print(e)
        return 1


def delete_table(name):
    print(&quot;Deleting table&quot;)
    try:
        sql_string = f&quot;DROP TABLE {name};&quot;
        with conn.cursor() as cur:
            cur.execute(sql_string)
            conn.commit()
            logger.info(&quot;The table &quot; + name  + &quot; has been removed.&quot; )
            return 0
    except psycopg2.Error as e:
        print(&quot;Rolling back&quot;)
        conn.rollback()
        print(&quot;Error deleting database&quot;)
        print(e)
        return 1
    

def lambda_handler(event, context):
    print(&quot;Running function&quot;)
    print(event)
    print(event[&apos;body&apos;][&apos;branch&apos;])
    print(event[&apos;body&apos;][&apos;action&apos;])
    branch_name = event[&apos;body&apos;][&apos;branch&apos;]
    action = event[&apos;body&apos;][&apos;action&apos;]
    print(&quot;Running action &quot; + action + &quot; on &quot; + branch_name)
    if action == &quot;CREATE&quot;:
        print(&quot;Calling create function&quot;)
        create = create_table(branch_name)
        print(f&quot;Create response {create}&quot;)
    elif action == &quot;DELETE&quot;:
        print(&quot;calling delete function&quot;)
        delete = delete_table(branch_name)
        print(f&quot;Delete Response {delete}&quot;)
    else:
        logger.error(&quot;INVALID ACTION&quot;)
    return 0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This function initialises a connection to the database using the &lt;code class=&quot;language-text&quot;&gt;psycopg2.connect&lt;/code&gt; function. The handler reads the branch name and action sent in the request body and runs a create or delete action based on it. The create and delete functions are called respectively. Each python function creates a SQL Query and runs it on the database. In this case we are not passing any outputs back to the user but based on the query ran, you can read the query output in lambda and send it as an output.&lt;/p&gt;
&lt;p&gt;This lambda function is also set up in the same VPC (network) as the RDS function so that it can access the database privately. To do this, we set up Advanced settings in the lambda console:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fa14298d039d2fde8f0904934949177f/2fb2d/lambda-vpc.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEUlEQVQoz42S63KEIAyFff+HbPtjW68siMhF0LMERZ212y0zZ6KTkHxJKDjnuN2+8VOWmKYJIQR4738V+d+pGJRC07To7hzaOlgXZS1ctG4Lcm7Vsix4dchHKhhj+Pj8Qt0yqFFDa4NR65gokx3E8zy/0FGo6LhE2zEYu9JYeyU8KN3JrqKOplgsUxZ3LiBEDzkojKPeL4dY+d05jyB/F1JKlGWFqq5RN00ktfBxMZlsbfksv/uNsZi3RPsMpRwg+ki4WVqSMSYF06Uc+B8lQi4EqG0iy6LFuD+fUNjnvZwIU0LG7qiqCkqNaXZ70kj5LHP+j0Up7pJQOw822PRkRC/TxugpEF1Idr7asPmjnhM+ABiDD5STEXCpAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;lambda-vpc&quot;
        title=&quot;lambda-vpc&quot;
        src=&quot;/static/fa14298d039d2fde8f0904934949177f/fcda8/lambda-vpc.png&quot;
        srcset=&quot;/static/fa14298d039d2fde8f0904934949177f/12f09/lambda-vpc.png 148w,
/static/fa14298d039d2fde8f0904934949177f/e4a3f/lambda-vpc.png 295w,
/static/fa14298d039d2fde8f0904934949177f/fcda8/lambda-vpc.png 590w,
/static/fa14298d039d2fde8f0904934949177f/efc66/lambda-vpc.png 885w,
/static/fa14298d039d2fde8f0904934949177f/c83ae/lambda-vpc.png 1180w,
/static/fa14298d039d2fde8f0904934949177f/2fb2d/lambda-vpc.png 1695w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The IAM Role created for lambda needs additional permissions if you use SSM, create an additional policy with the &lt;code class=&quot;language-text&quot;&gt;ssm:GetParameter*&lt;/code&gt; permission and attach it to lambda.&lt;/p&gt;
&lt;p&gt;Finally, we set up function URL’s in the aws lambda console under &lt;code class=&quot;language-text&quot;&gt;Configuration -&gt; Function URLS&lt;/code&gt; with AWS IAM Authentication so that only the bitbucket pipeline role can access it.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a3f59d6fc72e5d441332f64494e95da1/c65fa/lambda-url.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 15.54054054054054%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlklEQVQI111O0QqDMBDz/79qe9nYEGWve9QJrrZWe9W22pJ5wl4aCBcS7nKFGAZ8ug5Sz/DbhhACwjG993DOYV1XLBnZ/2dkLZQaMeoJ02xQEBH6/gshBLQ+AqUgpYQxBkQW+74jpYQUI+JB1nZZzkOsOfc+nI/wE4Umh9e7wfX2xOVe4lFWqOsKTduCy3gpB/tcloMLf0I85kLSIOJmAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;lambda-url&quot;
        title=&quot;lambda-url&quot;
        src=&quot;/static/a3f59d6fc72e5d441332f64494e95da1/fcda8/lambda-url.png&quot;
        srcset=&quot;/static/a3f59d6fc72e5d441332f64494e95da1/12f09/lambda-url.png 148w,
/static/a3f59d6fc72e5d441332f64494e95da1/e4a3f/lambda-url.png 295w,
/static/a3f59d6fc72e5d441332f64494e95da1/fcda8/lambda-url.png 590w,
/static/a3f59d6fc72e5d441332f64494e95da1/efc66/lambda-url.png 885w,
/static/a3f59d6fc72e5d441332f64494e95da1/c83ae/lambda-url.png 1180w,
/static/a3f59d6fc72e5d441332f64494e95da1/c65fa/lambda-url.png 1434w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;On the AWS Console for lambda, verify that the right AWS Role has access to the function URL under &lt;code class=&quot;language-text&quot;&gt;Lambda-&gt; Configuration -&gt; permissions -&gt; Resource based policy statements&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/39ac5e0f4988d4e6b968d74d5603a30c/f6f7a/lambda-permissions.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 77.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACA0lEQVQ4y4VUiW6jMBTM///fSlsSJVHTJDjk4LDBxsDsm8fRNG21SCNfMO+YMaskWWO332O73WG92eCR52jbFj6EEd4jyPgdfsLnXl3XWBVFCWstqqpCKSBBG6OSdl2Hvu8RZR2nPQXXXa8IsZsQ0TQeqzwvcDyecL3d9OUg4MfeB6TmomdlWema51GCJMbh7T1FIkiLBpltcXURzrdYkTW9ZMiuNyG9S9qNZsYs8qKAkTPu8b2e+5LVqfRIDgabU4ZtesMuvcNUYSRkqSQYhkHGfixR1nO5z+Aez2wQ+A5NBOo4LGiCEP75u0aaGumfhXVOein9dDXyOko5XjOSaBqQ4Hx5dP65x5asDicDY4ySOSFieU7UcjJarptGwbMozV+4lG/AGOOJ0Ejj748clSidi+JUvShLFYJzZl7InGsGU0gAtgAL6RPhWcqlmiTkx/yQZS9EbAFtZd1kp6jjTPKN8PBxxJLlRKgkMzRQtZDMAv1KOGfBchm9mxR+hWamxo7qVTriR8Ltbq89o89UGAoiAizzCRSkf8lwmJT+KsrlquYlTucUl+y6GJ13c0acrqJ6Ucv/JcNcfgZ8+skC8y0hQuzhibZHLWZuQpRxhPVfhVkI3w8foNJnyY4GpxAsn2VWTYtCrkNRtyhlLJ/mD9f+TMhyrB1NTczXcPbZ/57Xkv8Bkunc+u84WzQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;aws-lambda-verify-permissions&quot;
        title=&quot;aws-lambda-verify-permissions&quot;
        src=&quot;/static/39ac5e0f4988d4e6b968d74d5603a30c/fcda8/lambda-permissions.png&quot;
        srcset=&quot;/static/39ac5e0f4988d4e6b968d74d5603a30c/12f09/lambda-permissions.png 148w,
/static/39ac5e0f4988d4e6b968d74d5603a30c/e4a3f/lambda-permissions.png 295w,
/static/39ac5e0f4988d4e6b968d74d5603a30c/fcda8/lambda-permissions.png 590w,
/static/39ac5e0f4988d4e6b968d74d5603a30c/efc66/lambda-permissions.png 885w,
/static/39ac5e0f4988d4e6b968d74d5603a30c/f6f7a/lambda-permissions.png 1009w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Bitbucket Pipelines&lt;/h3&gt;
&lt;p&gt;The pipeline looks like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;image: &amp;lt;your-base-docker-image&gt;

pipelines:
  default:
    - step:
        name: Create RDS DB for branch
        oidc: true
        trigger: manual
        script:
          - export AWS_REGION=ap-southeast-2
          - export AWS_ROLE_ARN=arn:aws:iam::280714227524:role/BitbucketPipelinesOIDCRole
          - export AWS_WEB_IDENTITY_TOKEN_FILE=$(pwd)/web-identity-token
          - export AWS_WEB_IDENTITY_TOKEN_FILE=$(pwd)/web-identity-token
          - echo $BITBUCKET_STEP_OIDC_TOKEN &gt; $(pwd)/web-identity-token
          - echo &quot;Installing AWS CLI&quot;
          - yum update -y
          - echo $BITBUCKET_BRANCH | md5sum
          - export BRANCH_NAME=tb&quot;$(echo $BITBUCKET_BRANCH | md5sum)&quot;
          - echo $BRANCH_NAME
          - yum install -y python python-pip
          - pip install awscli
          - pip install awscurl
          - aws --version
          - awscurl --service lambda -X POST -d &apos;{&quot;branch&quot;:&quot;$BRANCH_NAME&quot;,&quot;action&quot;:&quot;CREATE&quot;}&apos; --region ap-southeast-2 $FUNCTION_URL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This step will pull the required variable &lt;code class=&quot;language-text&quot;&gt;FUNCTION_URL&lt;/code&gt; which is stored in the pipeline repository variables and use curl to call the HTTPS endpoint as we use a linux base on the pipeline step.
Note that a manual step has been created in the pipeline for additional security. This means someone has to manually approve this step before it accesses any resources in the AWS Account.&lt;/p&gt;
&lt;p&gt;The pipeline takes the branch name, hashes it with md5 and adds a &lt;code class=&quot;language-text&quot;&gt;tb&lt;/code&gt; prefix to it. This will be used as the table name.
Along with that it installs any required dependencies.&lt;/p&gt;
&lt;p&gt;In your pipeline, you can pass your AWS credentials by OIDC to curl while making your HTTPS request. The &lt;code class=&quot;language-text&quot;&gt;awscurl&lt;/code&gt; command helps us to automatically authenticate to follow AWS’s authentication signature as Function URLs with AWS_IAM Authentication &lt;/p&gt;
&lt;p&gt;The curl command looks like this:
&lt;code class=&quot;language-text&quot;&gt;awscurl --service lambda -X POST -d &apos;{&quot;branch&quot;:&quot;$BRANCH_NAME&quot;,&quot;action&quot;:&quot;CREATE&quot;}&apos; --region ap-southeast-2 $FUNCTION_URL&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Here, we give it the service it will call - lambda, run a HTTP POST request with the &lt;code class=&quot;language-text&quot;&gt;-X&lt;/code&gt; flag and give it the input data - the branch name and the action. We also provide the function url and aws region here.&lt;/p&gt;
&lt;h2&gt;Everything In Action&lt;/h2&gt;
&lt;p&gt;Once everything is in place, when the pipeline step is run the following output is seen:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/67119464e77e8992d6fb4e02a92f18f0/c8ad9/pipeline-succeess.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC0ElEQVQ4y41U2VLiUBDNV8yIoIjsAdl3AmEJq+CGigviVDk1//8HZ/p0EpRSp+bhVOfe293pPr0YseIIJ1kbgWgVh/G6Ipho/Beoe5LpIFFyYNZmiOb7MOJFB/GCg+N0G5FsF0epFn5Eyvh5Koj8G9Q7iFbUMe1DyRaMjHhujZ/QHD0qGsM1CtYlSp1rlLs3n1D6hGsURbdir5BrLWGcNRfozF7QmW7gXP2Gc/mG7vwFdXHsO6Vh2fbl6ktU+3fIty9gHAh3IeEjluuhPV6jObxDy7mHWR0jURwiURggKZLvKeGKnB2lmkrNUfKjdGGQXHJnVsYYLLZoj9aw5xsU20vkm+cotBYoyHe2PkPRukCmNkWqPHJ/JkiLXVJ+5J8Nv1LxQh/dqXAp0VFa4wdkPeN0ZaSSoDGDCMRqX0Idnp7ZiEnJ2+KkMbhFZ/KoSHsOzOpk55DfDCDwTXvtObQ8h7XejTovdS7VAelQZyIZNVvku35VDqNC+M7h8BZ1cVoiX15kac8hdcKmpc4+psnC7qXscjPcqzKjbI3uUeleaWSmRz4LyJT9IN6lrZ2gEfKC1RsuX7UojLQjhenOnlDrr1AXWJMHrT5/2pCfUq8nZ773pTsGy63SpBHG2WsSYdFaarRsET9dRsWUffAuL62Ua8x3LUTdfOtc7w1ywoewpEGymQ4RNl2cZLpCdlP58ZfHR/78M3kkjLDHR0KWBCUpCEnn++AkBFS5IgvjHQfenV+QoOhqlTl/g4s3tCfPsGSeuSgom86j3nGmOeu8t+evMudb4dc9852yJnPccB6EsisY6epUjO710j5/FWJpuEVPvm013khBnvXcW/zCZPXHXSBcKLON2GzVhluq4axhcO8FE3Ud7FCyoSkcxmu6MLR5BUxNF6qk5uo1d2/8Dno86nIg8aZEGc31dWJc2dvD7k44joiOr3csBeVSde/kTTb/X6fKapFci9n6AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;pie-success&quot;
        title=&quot;pie-success&quot;
        src=&quot;/static/67119464e77e8992d6fb4e02a92f18f0/fcda8/pipeline-succeess.png&quot;
        srcset=&quot;/static/67119464e77e8992d6fb4e02a92f18f0/12f09/pipeline-succeess.png 148w,
/static/67119464e77e8992d6fb4e02a92f18f0/e4a3f/pipeline-succeess.png 295w,
/static/67119464e77e8992d6fb4e02a92f18f0/fcda8/pipeline-succeess.png 590w,
/static/67119464e77e8992d6fb4e02a92f18f0/efc66/pipeline-succeess.png 885w,
/static/67119464e77e8992d6fb4e02a92f18f0/c83ae/pipeline-succeess.png 1180w,
/static/67119464e77e8992d6fb4e02a92f18f0/c8ad9/pipeline-succeess.png 1564w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;
This output will show up as &lt;code class=&quot;language-text&quot;&gt;Forbidden&lt;/code&gt; if the permissions are not set up correctly. The output can also be modified in your lambda function as required.&lt;/p&gt;
&lt;p&gt;This means that the lambda function has been run successfully. On checking the lambda logs in cloudwatch we see the following output:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1024781949cabeaaddb2b0df606cfaec/0d390/lambda-log.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABdElEQVQoz5VT2baCMAzk/3/yyk4LxbIjLcZMFKye++LDnEmXkGGSRterJa01KaXJ2o7quqGmMdS2rbAxRljxHdwVWEuGz533tO87eQZ4vd0oqpSivCioKEv56DhNNIwjjYxhGCQG+iD+2BveZ7brKEKSrmtJxobl6vh41/VUVYq5o77vpdiyLDQzIAI5bXuldV3lDtbzPFNUlBVd4oTiJKUszylJM+G/S8yJWj4wsWoBJ0zzJH9xYAq448IR/IEqeLA5Rw5gb7Zte8YMxNvmzj3P5wfcC373tLBa8RCKyqpiLs44zbJTOeIkTWUNhupD1amQ1YtCdA2drZtnd8GohM4dav9T9IGXalGodM0KclGGcRDPxKvfMB8K4R9mDOrEry/PBC6Iw73gPnJFYVGU4kuavn2Kk0T8hHKsMafwEWtMASYg5zyMF/JxhhzN1kXm9SIwR415eohq4Qs4OIT/wn6/80zyS9Hs4dFVMPwI5+wXWPbwAQ04luxD5julAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;lambda-output&quot;
        title=&quot;lambda-output&quot;
        src=&quot;/static/1024781949cabeaaddb2b0df606cfaec/fcda8/lambda-log.png&quot;
        srcset=&quot;/static/1024781949cabeaaddb2b0df606cfaec/12f09/lambda-log.png 148w,
/static/1024781949cabeaaddb2b0df606cfaec/e4a3f/lambda-log.png 295w,
/static/1024781949cabeaaddb2b0df606cfaec/fcda8/lambda-log.png 590w,
/static/1024781949cabeaaddb2b0df606cfaec/efc66/lambda-log.png 885w,
/static/1024781949cabeaaddb2b0df606cfaec/c83ae/lambda-log.png 1180w,
/static/1024781949cabeaaddb2b0df606cfaec/0d390/lambda-log.png 1472w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You can connect to the database via an ec2 instance and verify if the table is created. Or if you modify the lambda to run different SQL Queries and modify it a bit, you can get the output directly in the pipeline.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;In this blog, we looked at an example where developers could run scripts on the database of an application before or after running the CICD pipeline using AWS lambda function URLs along with AWS Lambda.&lt;/p&gt;
&lt;p&gt;In conclusion, Function URLs along with AWS IAM Authentication allow you to securely access lambda functions from an HTTPS Endpoint without the need to set up API Gateways. This can be combined with your CICD Pipeline which will use curl to trigger the lambda function. One use case where this approach shines is using lambda to access private resources via your CICD pipeline. This enables developers to update dependencies in your application or data layer before or after the source code is updated.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using ChatOps to streamline operational activites on AWS]]></title><description><![CDATA[Today I’d like to introduce you to ChatOps, the practice of centralising operational activites to chat applications with an interactive…]]></description><link>https://www.hitarthasrani.com/2023-12-01-aws-chatbot/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2023-12-01-aws-chatbot/</guid><pubDate>Fri, 01 Dec 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Today I’d like to introduce you to &lt;em&gt;ChatOps&lt;/em&gt;, the practice of centralising operational activites to chat applications with an interactive ChatBot. In this use case, the Chatbot allows you to get information from your AWS Account and query for information from your aws account.&lt;/p&gt;
&lt;p&gt;Traditionally, this would involve configuring integrations with Slack or Teams and setting up your own chatbot that will respond to commands or alert you about anything you program it to do. This process can be lengthy, technically challenging or costly. Luckily for us, AWS has a solution that makes this super quick (just make sure you have admin access for your chat client or know someone with the right permissions).&lt;/p&gt;
&lt;p&gt;AWS ChatBot allows us to quickly set up an integration with AWS Chime, Slack or Teams and get a chatbot up and running in no time. Some of the useful things AWS ChatBot can do for you:&lt;/p&gt;
&lt;h2&gt;Notify&lt;/h2&gt;
&lt;p&gt;AWS Chatbot can notify you about events happening on your AWS account.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Alert you on findings from SecurityHub, CloudWatch Alarms and anything via SNS.&lt;/li&gt;
&lt;li&gt;Notify you of Budget alerts&lt;/li&gt;
&lt;li&gt;Alert you on events from Cloudformation Stacks or AWS Dev tools from CodeBuild, CodePipeline and CodeDeploy.&lt;/li&gt;
&lt;li&gt;Other services include AWS Config, Amazon GuardDuty, Amazon EventBridge, the AWS Health dashboard.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Command&lt;/h2&gt;
&lt;p&gt;This allows you to command AWS ChatBot for information or allow ChatBot to trigger AWS Services&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Invoke a lambda function to start a workflow&lt;/li&gt;
&lt;li&gt;Get diagnostic information from certain AWS Services like EC2, CloudWatch alerts&lt;/li&gt;
&lt;li&gt;Run ReadOnly or mutative commands supported by AWS CLI in your Chat Application&lt;/li&gt;
&lt;li&gt;Restart EC2 instances and use AWS Systems Manager to resolve incidents&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Customise&lt;/h2&gt;
&lt;p&gt;You can customise command aliases which look something like:
&lt;code class=&quot;language-text&quot;&gt;@aws alias create alias_name mapped_action&lt;/code&gt; - to create an alias for a mapped action;
&lt;code class=&quot;language-text&quot;&gt;@aws alias list&lt;/code&gt; - to list out aliases created;
&lt;code class=&quot;language-text&quot;&gt;@aws run alias_name&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;@aws alias run alias_name&lt;/code&gt; - to run a specific alias&lt;/p&gt;
&lt;p&gt;You can also customise notifications sent by AWS Chatbot using a JSON syntax. Here’s an example&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
&quot;version&quot;: &quot;1.0&quot;,
&quot;source&quot;: &quot;custom&quot;,
&quot;id&quot;: &quot;c-weihfjdsf&quot;,
&quot;content&quot;: {
    &quot;textType&quot;: &quot;client-markdown&quot;,
    &quot;title&quot;: &quot;:warning: Banana Order processing is down!&quot;,
    &quot;description&quot;: &quot;Banana Order processor application is no longer processing orders. OnCall team has beeen paged.&quot;,
    &quot;nextSteps&quot;: [
    &quot;Refer to &amp;lt;http://www.example.com|*diagnosis* runbook&gt;&quot;,
    &quot;@googlie: Page Jane if error persists over 30 minutes&quot;,
    &quot;Check if instance i-04d231f25c18592ea needs to receive an AMI rehydration&quot;
    ],
    &quot;keywords&quot;: [
    &quot;BananaOrderIntake&quot;,
    &quot;Critical&quot;,
    &quot;SRE&quot;
    ]
},
&quot;metadata&quot;: {
    &quot;threadId&quot;: &quot;OrderProcessing-1&quot;,
    &quot;summary&quot;: &quot;Order Processing Update&quot;,
    &quot;eventType&quot;: &quot;BananaOrderAppEvent&quot;,
    &quot;relatedResources&quot;: [
    &quot;i-04d231f25c18592ea&quot;,
    &quot;i-0c8c31affab6078fb&quot;
    ],
    &quot;additionalContext&quot;: {
    &quot;priority&quot;: &quot;critical&quot;
    }
}
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Please note that the &lt;code class=&quot;language-text&quot;&gt;metadata&lt;/code&gt; section will be supported in a future release.&lt;/p&gt;
&lt;h2&gt;Caveats, Security and other stuff people dont think about&lt;/h2&gt;
&lt;p&gt;Like with any service, there’s some caveats when you use this AWS service. Please keep this in mind when using a service to make sure it works with your use case. Alternatively, design around these caveats when building your chatbot.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Unsupported services&lt;/strong&gt; - The following services are unsupported commands that are not available to use with AWS ChatBot.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&quot;appsync:ListApiKeys&quot;,
&quot;chatbot:*&quot;,
&quot;codecommit:GetFile&quot;,
&quot;codecommit:GetCommit&quot;,
&quot;codecommit:GetDifferences&quot;,
&quot;cognito-idp:*&quot;,
&quot;cognito-identity:*&quot;,
&quot;connect:GetFederationToken&quot;,
&quot;dynamodb:BatchGetItem&quot;,
&quot;dynamodb:GetItem&quot;,
&quot;ec2:GetPasswordData&quot;,
&quot;ecr:GetAuthorizationToken&quot;,
&quot;ecr:GetLogin&quot;,
&quot;gamelift:RequestUploadCredentials&quot;,
&quot;gamelift:GetInstanceAccess&quot;,
&quot;identitystore:*&quot;,
&quot;lightsail:DownloadDefaultKeyPair&quot;,
&quot;lightsail:GetInstanceAccessDetail&quot;,
&quot;lightsail:GetKeyPair&quot;,
&quot;lightsail:GetKeyPairs&quot;,
&quot;lightsail:UpdateRelationalDatabase&quot;,
&quot;iam:*&quot;,
&quot;kms:*&quot;,
&quot;redshift:GetClusterCredentials&quot;,
&quot;sdb:*&quot;,
&quot;secretsmanager:*&quot;,
&quot;sso:*&quot;,
&quot;sso-admin:*&quot;,
&quot;sso-oidc:*&quot;,
&quot;storagegateway:DescribeChapCredentials&quot;,
&quot;sts:*&quot;,
&quot;s3:GetObject&quot;,
&quot;s3:HeadObject&quot;,
&quot;s3:PutObject&quot;,
&quot;s3:GetBucketPolicy&quot;,
&quot;snowball:GetJobUnlockCode&quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;Teams/Slack/Chime integration&lt;/strong&gt; - This is a quick solution to integrate &lt;em&gt;provided you have the right permissions on AWS and your Chat Application&lt;/em&gt;. If you are planning to set this up for a teams channel in a large organization, please have someone from your Internal IT team or your Teams/Slack channel admin help you out with accepting and setting up AWS Chatbot on the chat client.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Security and Permissions&lt;/strong&gt; - Now, the ability to read and modify your cloud resources from your teams channel is something that can be very powerful but also very damaging in the wrong hands. AWS Provides some predefined permission templates such as “ReadOnly” permissions. AWS also allows you to have GuardRails for users so that they cannot run certain commands. Additionally Audit logs are enabled by default, and log the commands, workspace ID, Channel ID, and the Channel user ID. Lastly, CloudWatch can log all errors or all commands that are run by aws chatbot.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Pricing&lt;/strong&gt; - You pay only for any underlying services used such as SNS, CloudWatch, GuardDuty or SecurityHub.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Others&lt;/strong&gt; -&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If you have thousands of alerts in a specific region you must make sure you have the correct Disaster Recovery process and channel design to combat the thousands of alerts you may get if a region goes down.&lt;/li&gt;
&lt;li&gt;Check the SLA with AWS as I could not find anything on this and AWS Chatbot in the end is an AWS Managed service. With any integation, all parts must work together to provide a coherent solution.&lt;/li&gt;
&lt;li&gt;Make sure your chat’s service plan can handle the volume of alerts your AWS accounts will send. Some chat services like Slack’s free tier have volume and time limits on messages.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Amazon Linux 2023 just dropped]]></title><description><![CDATA[If you’re running workloads on the cloud, chances are you’re machines are running linux. RedHat, Fedora, Ubuntu, etc. There’s many flavours…]]></description><link>https://www.hitarthasrani.com/2023-03-21-amazon-linux-3/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2023-03-21-amazon-linux-3/</guid><pubDate>Tue, 21 Mar 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If you’re running workloads on the cloud, chances are you’re machines are running linux. RedHat, Fedora, Ubuntu, etc. There’s many flavours to choose from, but then again if you’re on AWS you’re probably familiar with Amazon Linux (AL). As part of their release schedule, AWS releases a new major version every 2 years and Amazon Linux 2023 (AL2023) just dropped in General availability on the 15th of March 2023.&lt;/p&gt;
&lt;p&gt;Amazon Linux is AWS’s rpm based linux distro for general purpose workloads and integrates with AWS services. It is designed for scale and LTS. From AL2023 onwards, AWS will release a new version of Amazon Linux every 2 years.&lt;/p&gt;
&lt;h2&gt;The Benefits&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Long Term Support&lt;/li&gt;
&lt;li&gt;Predictable Release Cycle - plan your upgrades and migrations&lt;/li&gt;
&lt;li&gt;Versioned repositories for AL2023 = more consistent OS updates.&lt;/li&gt;
&lt;li&gt;Security Upgrades and Compliance - SELinux is enabled by default on permissive mode (permission denials are logged but not enforced). You can also set security policies at boot time.&lt;/li&gt;
&lt;li&gt;OS Level Optimisations.&lt;/li&gt;
&lt;li&gt;Kernal Hardening and Live Patching.&lt;/li&gt;
&lt;li&gt;Use AL2023 at no additional cost as part of your EC2 package (Please check EC2 pricing).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;What should engineers know about AL2023?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Standard support - 2023 &amp;#x26; 2024.&lt;/li&gt;
&lt;li&gt;Maintenance - 2025 - 2027.&lt;/li&gt;
&lt;li&gt;Package manager: dnf.&lt;/li&gt;
&lt;li&gt;Uses the XFS Filesystem on the root filesystem.&lt;/li&gt;
&lt;li&gt;Networking interfaces are managed by the &lt;code class=&quot;language-text&quot;&gt;systemd-networkd&lt;/code&gt; system service. Amazon Linux 2 used &lt;code class=&quot;language-text&quot;&gt;dhclient&lt;/code&gt; previously.&lt;/li&gt;
&lt;li&gt;OpenSSL 3 - The Open Secure Socket Layer v3 (OpenSSL) cryptography toolkit is available. It uses the SSL v2/vv3 and TLS v1 network protocols and the required cryptography standards.&lt;/li&gt;
&lt;li&gt;IMDSv2 - Any instances launched with AL2023 will require the use of IMDS v2 and the default hop limit will be set to 2 to help with containerised workloads. This can be manually overridden if needed.&lt;/li&gt;
&lt;li&gt;Check support info on a specific package: &lt;code class=&quot;language-text&quot;&gt;sudo dnf supportinfo --packagename&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Check support info on all installed packages: &lt;code class=&quot;language-text&quot;&gt;sudo dnf supportinfo --show installed&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Customise cloud-init to configure them dynamically: Create your cloud-init action files in &lt;code class=&quot;language-text&quot;&gt;/etc/cloud/cloud.cfg.d&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Networking configurations generated in: &lt;code class=&quot;language-text&quot;&gt;/run/systemd/network&lt;/code&gt;. You can add custom config files to &lt;code class=&quot;language-text&quot;&gt;/run/systemd/network&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;/etc/systemd/network&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Python 3.9 (System Python) has security support until March 2028&lt;/li&gt;
&lt;li&gt;AL2023 is based on Fedora, but not any single release - there are components from more than one release of Fedora -  some of which are modified.  Other components more closely resemble the components in CentOS Stream 9 or were developed independently.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AWS Integration is still a work in progress for some services (CodeDeploy,Inspector as of writing this), check the GitHub pages for known issues&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There’s a lot to take in for this new OS which will most likely be the default OS you use for general purpose workloads on AWS. As with anything else in technology, there will always be bugs. Check the known issues, plan and prepare yourself before committing to any different tech, especially when it comes to Operating Systems.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Discussion forum: &lt;a href=&quot;https://forums.aws.amazon.com/forum.jspa?forumID=228&quot;&gt;https://forums.aws.amazon.com/forum.jspa?forumID=228&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Github Issues Page: &lt;a href=&quot;https://github.com/amazonlinux/amazon-linux-2023/issues&quot;&gt;https://github.com/amazonlinux/amazon-linux-2023/issues&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Known Issues: &lt;a href=&quot;https://docs.aws.amazon.com/linux/al2023/release-notes/relnotes-20230315.html&quot;&gt;https://docs.aws.amazon.com/linux/al2023/release-notes/relnotes-20230315.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Roadmap: &lt;a href=&quot;https://github.com/amazonlinux/amazon-linux-2023/projects/1&quot;&gt;https://github.com/amazonlinux/amazon-linux-2023/projects/1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Amazon Linux 2023 home page: &lt;a href=&quot;https://aws.amazon.com/linux/amazon-linux-2023/&quot;&gt;https://aws.amazon.com/linux/amazon-linux-2023/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;AL2023 packages: &lt;a href=&quot;https://docs.aws.amazon.com/linux/al2023/release-notes/all-packages.html&quot;&gt;https://docs.aws.amazon.com/linux/al2023/release-notes/all-packages.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Using the New AWS Auckland Location in AWS Direct Connect]]></title><description><![CDATA[On the 10th of March, AWS announced a new AWS Direct Connect location in Auckland. This is part of the new AWS Region planned for Auckland…]]></description><link>https://www.hitarthasrani.com/2023-03-13-aws-direct-connect-auckland/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2023-03-13-aws-direct-connect-auckland/</guid><pubDate>Mon, 13 Mar 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;On the 10th of March, AWS announced a new AWS Direct Connect location in Auckland. This is part of the new AWS Region planned for Auckland.&lt;/p&gt;
&lt;h2&gt;AWS Direct Connect?&lt;/h2&gt;
&lt;p&gt;AWS Direct Connect is AWS’s service to create a dedicated network connection to AWS. Any company that wants to connect their exisitng on-premises solutions or network to AWS should have a way to connect their resoruces to AWS, especially if they do not want to use the public internet for this.&lt;/p&gt;
&lt;p&gt;The benefits this brings are mainly around security, reliability (with regards to latency), scalability (w.r.t. data transfers and real time data analysis)&lt;/p&gt;
&lt;p&gt;Setting up Hybrid connectivity can be an integral part of any enterprise’s cloud journey. I can think of the following scenarios where this new Direct Connect location can be helpful:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Any kiwi business looking at migrating to AWS; and specifically wanting to utilise the upcoming Auckland Region instead of the existing Sydney (ap-southeast-2) region.&lt;/li&gt;
&lt;li&gt;Any kiwi business that already uses AWS and has set up Direct Connect using one of the Sydney locations and wants to set up their network for High Resiliency, utilising multiple locations.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;What you should know about AWS Direct Connect&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Direct connect offers two types of connections -&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Hosted Connection: A connection provisioned by an AWS Direct Connect Partner on behalf of a customer. (Bandwidth options - 50 Mbps, 100 Mbps, 200 Mbps, 300 Mbps, 400 Mbps, 500 Mbps, 1 Gbps, 2 Gbps, 5 Gbps, and 10 Gbps.)&lt;/li&gt;
&lt;li&gt;Dedicated Connection: A connection associated with once customer (Bandwidth options: 1Gbps, 10Gbps and 100 Gbps)&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Direct Connect uses BGP (Border Gateway Protocol) to connect to your on-prem location. You will need to configure this when you set up a virtual interface or VIF for your connection.&lt;/li&gt;
&lt;li&gt;To encrypt your traffic, you can use MAC Security or MACsec which is available on dedicated connections.&lt;/li&gt;
&lt;li&gt;Direct Connect works with Direct Connect Gateways and Transit VIFs to connect to your AWS Transit Gateway and VPCs in the same region to your on premises network.&lt;/li&gt;
&lt;li&gt;Also look at Private VIFs, Public VIFs and LAGs (Link Aggregation Groups)&lt;/li&gt;
&lt;li&gt;The Auckland location offers dedicated 1 Gbps and 10 Gbps connections, with MACsec encryption available for 10 Gbps.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Using the Auckland Location&lt;/h2&gt;
&lt;p&gt;If you use a Hub and Spoke networking model, create your AWS Direct Connect connection in your “Hub” or “Shared Services” account. Ideally, this will also be the account where your Transit Gateway lives.&lt;/p&gt;
&lt;p&gt;In the AWS Console, search for &lt;code class=&quot;language-text&quot;&gt;Direct Connect&lt;/code&gt; then click on &lt;code class=&quot;language-text&quot;&gt;Create a Connection&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Once here, you can enter a connection name, your location (&lt;strong&gt;IMPORTANT This needs to be set to &lt;code class=&quot;language-text&quot;&gt;Datacom DH6, Auckland&lt;/code&gt;&lt;/strong&gt;), your connection speed and your on prem service provider. Refer to the picture below for an example.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/91589775e52f83948608de10f70f0b90/65d79/direct-connect-connection.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 102.02702702702702%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAACaUlEQVQ4y32U63KbMBCF8/6P1h9t4/E0SSc24MQYDIiLEBLicrorcExsU2Y+JBAcrc6u9OT5AX49b/Dy+ortdovnzQZ730eaZTgnqSNJqZ1JHNncz9xzXhSopERZVXg6fHyS2F+8vXv48x4QPrzggJ3nk3CAvRdM7aLP4978jr87RTFkXU+CrM7RZHmBJK8QixK1Umh0g6a5ohbtbZ+/ZzEnyDefZ/U8HAKacbfD6RSh6zpYax1dZ9ETnV3na8msngkBQSTklzYGfI3jiGEYHG03QBN2BOwAtP04Mcz0w1XQtK0L2Z994STwAL/j6Egaseqw8SLswhRhqRHLFhFxqowjNwvBRmv6sSOBpR9y9tGg5eUYi7TWiHKJc6lcP5UTCVHq9irIN5eUTLi2LEsYWramiXiyS1IM9Vt6b4x2/SWaxqtqIfh5PFIiTgjDkxNm3zgpS+yCR2NfEUrqZBSZJS9bxrQuupFEKTP3YIKTNrrnKYHXJZN3Xhjh40zJIM9ypSGIgnwpbyEveUy19kvoTjCTCj93n/jxssfvY4G3VCOsLY7yHn4fFBpZ064LSorQP0aOV+8DkaigqcZq20PdQeWhLTRVxaqgovJIk4SyVLmKZy95Z4zjxcPvLXu7FLoTzGWD/SFESqcGZ8tQUpjJ9FkL37mIPBTkrcalwhE+ui4/3rKelEohCGPEcQxBJ04mcne+MSLP0fX99NPKRPdJoVtERX2kc1HSLmnoXFOE5q1HbaNqGNoJY99NkC2uRleTIlLI5IwqS6FyAVvLhwyNwkBnZF8Vrl0V1BRBXwia2eJ/121ibj29CP4DqiEIV7P7TNgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;direct-connect-create-wizard&quot;
        title=&quot;direct-connect-create-wizard&quot;
        src=&quot;/static/91589775e52f83948608de10f70f0b90/fcda8/direct-connect-connection.png&quot;
        srcset=&quot;/static/91589775e52f83948608de10f70f0b90/12f09/direct-connect-connection.png 148w,
/static/91589775e52f83948608de10f70f0b90/e4a3f/direct-connect-connection.png 295w,
/static/91589775e52f83948608de10f70f0b90/fcda8/direct-connect-connection.png 590w,
/static/91589775e52f83948608de10f70f0b90/efc66/direct-connect-connection.png 885w,
/static/91589775e52f83948608de10f70f0b90/65d79/direct-connect-connection.png 905w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;You can also set additonal settings for MACsec support, existing LAGs and Tagging for this AWS resource.&lt;/p&gt;
&lt;p&gt;Reach out to me, AWS or an AWS partner if you want to understand the costs associated with AWS Direct Connect, whether it is the right solution for you or if you want to set up a Hybrid cloud environment for your enterprise.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Moving 75,000 files in S3]]></title><description><![CDATA[In my opinion, AWS S3 is by far the most popular and widely used services. I dare say it is the most versatile AWS service. There’s so much…]]></description><link>https://www.hitarthasrani.com/2023-03-06-bulk-s3-bucket-transfer/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2023-03-06-bulk-s3-bucket-transfer/</guid><pubDate>Mon, 06 Mar 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In my opinion, AWS S3 is by far the most popular and widely used services. I dare say it is the most versatile AWS service. There’s so much you can do - general object storage, use it for static file hosting/ content delivery, use it as a service for backups, store and query your log data with SQL using Athena or archive all your data using S3 Glacier and S3 Glacier deep archive. Naturally, a lot of companies want to make the most out of cloud storage  and decrease the cost spent on storing IT information on premises. There’s a lot of data in the world, just look at Facebook…errr…Meta (or any other tech company?) and the concerns governments have about data privacy.&lt;/p&gt;
&lt;h2&gt;The Situation?&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;TLDR: my bucket has a lot of files and more files are uploaded every hour. How do I move anything (that was not uploaded today) to another folder in the same bucket&lt;/strong&gt;
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/63a626e7ed037c8eb78569654467f2ec/29c1d/s3-tldr.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.70270270270271%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABb0lEQVQoz62SW0/CQBCF+/9/gm+aoNGoiQ+++R+MIrSACnKnpaX3eznuGSlpjby5yWSW7szZbw6r4bD2+z1OreNZo+ZUvdY8zIsKjptiPPXw2rfQ1bd4H7uIkwJhlCOKCwRhDtdLj6K/hVuCaVoizUoMP3bo3Bm4VPH4NEZvYOPlzcJz15Sw7Pgkpda8hRQs/pi4uHkY4up+gPNrHWcXXXRuDaE1Rg4Wq6BF2NRoEdpOIuNQmKM5u0QEpnNfjZsjzysUyhZzGyNTkzR7j4LVYcPm1SbEch1ivgx+siL5VLQT5SmpZotA5VDy2oykh6tqUAohTV9tImwV4Uj5R6q+8q1n2OKnPnTER37jma5iY0XSw2laHtZiHJVj8mZSkJCZ1KTjb+5J/TXzxR7Pz+Rb/QqEkDfxgx9kIlg/Dxazkf7RgjpYQz+ZgzCT+kT1E4TPTuNNFKuDQsw7RWxasfwBvJTBPc+9P+ppV1kePPzP9Q1GkUzHInn/3gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;what a situation&quot;
        title=&quot;what a situation&quot;
        src=&quot;/static/63a626e7ed037c8eb78569654467f2ec/fcda8/s3-tldr.png&quot;
        srcset=&quot;/static/63a626e7ed037c8eb78569654467f2ec/12f09/s3-tldr.png 148w,
/static/63a626e7ed037c8eb78569654467f2ec/e4a3f/s3-tldr.png 295w,
/static/63a626e7ed037c8eb78569654467f2ec/fcda8/s3-tldr.png 590w,
/static/63a626e7ed037c8eb78569654467f2ec/efc66/s3-tldr.png 885w,
/static/63a626e7ed037c8eb78569654467f2ec/c83ae/s3-tldr.png 1180w,
/static/63a626e7ed037c8eb78569654467f2ec/29c1d/s3-tldr.png 1375w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Let’s say you are utilising S3 buckets to store files…lots of files…not “I am big tech” kind of files, rather medium to large enterprise kind of files. What kind of files you ask? Maybe text files, json files or anything else. Each file is somewhere between a few hundred KBs to a couple of MBs. But you want to know how many files we have? OK, we got around 75,000 files.&lt;/li&gt;
&lt;li&gt;Now you also want to move &lt;em&gt;some&lt;/em&gt; (74,500) files from one folder (ie. ‘folder1’) to a new folder (ie. ‘folder1_old’) based on when they were uploaded. So that you can clean up this folder, keeping only the files uploaded today. This is easy with the S3 console when you have a few files (say less than a 1000) but the option goes away once you cross the 999+ files mark. Check the images below for an example.
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/efda9b1da41fe1fcb1ce5103318810f1/78363/s3-objects-lessthan1000.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 14.18918918918919%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlklEQVQI1z1OwQ0CMQy7/YdhEwbgD9IhRC9t2iZpQSapTjwsK5Zje9v3J2prqPVE6yhNHfLXmatzRXFmSuDXA5Xz6RWoGUZgDGwHZeTCaL2vgGDyOx0E9pDeBQcRSil4E4PvN9TrBZJ26JhQNZiNFda8YHun5E8d5oKdLSJ9LVJVzDkXNy8TEVAusM8Xw/Xwx2/oURqDforz50ob0og2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;#39;sorting less than 999 files&amp;#39;&quot;
        title=&quot;&amp;#39;sorting less than 999 files&amp;#39;&quot;
        src=&quot;/static/efda9b1da41fe1fcb1ce5103318810f1/fcda8/s3-objects-lessthan1000.png&quot;
        srcset=&quot;/static/efda9b1da41fe1fcb1ce5103318810f1/12f09/s3-objects-lessthan1000.png 148w,
/static/efda9b1da41fe1fcb1ce5103318810f1/e4a3f/s3-objects-lessthan1000.png 295w,
/static/efda9b1da41fe1fcb1ce5103318810f1/fcda8/s3-objects-lessthan1000.png 590w,
/static/efda9b1da41fe1fcb1ce5103318810f1/efc66/s3-objects-lessthan1000.png 885w,
/static/efda9b1da41fe1fcb1ce5103318810f1/c83ae/s3-objects-lessthan1000.png 1180w,
/static/efda9b1da41fe1fcb1ce5103318810f1/78363/s3-objects-lessthan1000.png 1522w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/114b04c02e888e5d2629b123776578e3/087e3/s3-objects-1000.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 18.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuUlEQVQY0z2OaxLCIAyEe//7eA3HE/jDx6ilUMoz0DrrgtUf3yzZJBuGu/a4To4suGmH2/SleRe14OUydFoxRdI0vcnGuv5RgbCvfMbwGhV8iCTsmrAQt3shxt0nnrU18M7ST/AxI2aBSIGUgpQZqM3cB/sy6UEc9PEbaK2F1gazXaDVCH86IJyPkLr1gBZWa0VhYOTOYOYZmVd+ZtPMwUZbeDyecM5hXdfeq5KppfeLSFfDTwnfLfAD2X4zalfn4UAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;&amp;#39;sorting more than 999 files&amp;#39;&quot;
        title=&quot;&amp;#39;sorting more than 999 files&amp;#39;&quot;
        src=&quot;/static/114b04c02e888e5d2629b123776578e3/fcda8/s3-objects-1000.png&quot;
        srcset=&quot;/static/114b04c02e888e5d2629b123776578e3/12f09/s3-objects-1000.png 148w,
/static/114b04c02e888e5d2629b123776578e3/e4a3f/s3-objects-1000.png 295w,
/static/114b04c02e888e5d2629b123776578e3/fcda8/s3-objects-1000.png 590w,
/static/114b04c02e888e5d2629b123776578e3/efc66/s3-objects-1000.png 885w,
/static/114b04c02e888e5d2629b123776578e3/c83ae/s3-objects-1000.png 1180w,
/static/114b04c02e888e5d2629b123776578e3/087e3/s3-objects-1000.png 1575w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;For convenience sake, you have some prefixes you can use to filter some files, &lt;em&gt;sometimes&lt;/em&gt; but there’s also &lt;em&gt;20 or more different prefixes&lt;/em&gt; because why not. Why? because you, my dear reader, &lt;strong&gt;also&lt;/strong&gt; have to transfer some files to another folder every couple of hours based on the prefixes. These files get processed and moved using s3 events. &lt;em&gt;Note that this automation using s3 events and lambda is also in place but inactive until tomorrow or when you start it&lt;/em&gt;. You decide to do this manually because you didnt know there were 75,000 files.&lt;/li&gt;
&lt;li&gt;We’re going production coz of course we are. AKA Time pressure and clogged thinking.&lt;/li&gt;
&lt;li&gt;The cherry on top: every hour you get 80 - 100 files more.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;A viable solution but there might be a better way&lt;/h2&gt;
&lt;p&gt;Step 0: Check your folders.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Let’s say your files are in the “folder1” folder, create a new folder called “folder1_old” to store all the old files you want to move out from “folder1”&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Step 1: Immidiately transfer any files that need to be processed into the “process_me” folder . (If you take more than an hour you will have to do this again)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Do this manually if needed. VERY HIGHLY DO NOT RECOMMEND THIS APPROACH
OR&lt;/li&gt;
&lt;li&gt;Do an &lt;code class=&quot;language-text&quot;&gt;aws s3 ls --summarize&lt;/code&gt; and save the output as a text file. (The time taken for this depends on the number of objects in that bucket/folder)&lt;/li&gt;
&lt;li&gt;Import the text file into Excel, using only the columns for “Upload Date” and “object name/file name”&lt;/li&gt;
&lt;li&gt;Sort the excel sheet using the date to find out what files were uploaded today.&lt;/li&gt;
&lt;li&gt;Copy the names of all files uploaded today into a text file.&lt;/li&gt;
&lt;li&gt;Use ChatGPT to write a script that copies files from your bucket’s folder1 to test, using above text file as input for filenames. Make some changes/fixes if needed. End result of script is:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;#!/bin/bash

# Set the names of the source and destination buckets
source_bucket=&quot;your-source-bucket-name&quot;
destination_bucket=&quot;your-destination-bucket-name&quot;

# Read in the list of filenames from a file called &quot;filenames.txt&quot;
# The file should have one filename per line

while read filename; do
  # Use the AWS CLI to move the file from the source bucket to the destination bucket
  aws s3 mv &quot;s3://${source_bucket}/${filename}&quot; &quot;s3://${destination_bucket}/${filename}&quot;
done &amp;lt; filenames.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note: this script can be modified later to do other things&lt;/p&gt;
&lt;p&gt;Repeat this step if the clock has past the hour, more files have been sent to this folder.&lt;/p&gt;
&lt;p&gt;Step 2: If this is done before the clock strikes the next hour ^*:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;do a &lt;code class=&quot;language-text&quot;&gt;s3 sync &amp;lt;source&gt; &amp;lt;destination&gt;&lt;/code&gt; to copy all missing files/sync all files from “folder” into the “folder1_old” folder.&lt;/li&gt;
&lt;li&gt;do a &lt;code class=&quot;language-text&quot;&gt;s3 rm bucket/folder --include &quot;*&quot; --exclude &quot;file1.do_not_forget_extension&quot; --exclude &quot;file2.do_not_forget_extension&quot; ..... --exclude &quot;last_file_to_exclude.do_not_forget_extension&quot;&lt;/code&gt; To remove all files that were just copied to folder1_old if all of them were copied successfully.
When using this script to remove the files, there’s some thing to remember: you need to add the file extension in the exclude option and you need to manually or magically(using another script) add all the files to exclude as exclude options into a command that you run.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Step 3: Enable automation to process files from folder1 now.&lt;/p&gt;
&lt;h2&gt;Alternatives?&lt;/h2&gt;
&lt;p&gt;I did not look into using S3 batch operations while solving the above issue, but there is some kind of solution there which allows you to copy files across buckets/folders in a bucket and allows you to filter files with some options. I might discuss this solution in a future blog.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c843c7462b1235dfc0bb2a0bcf616a43/c8e86/s3-batch-operations-filter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAACOElEQVQ4y61U2Y6bQBDkNzcvXm0Ur5Q4X5vkLT7XwHCDYcxh7EpXG6w9HNmRglSaAeOequpqnL7vUdYdViaDG+Ww1qIsK1SVPcOeUVYV7H5/ea774TfurT3DqeRF3zdougP+x+Xsdjus12t4no/t1tXV82XvukizDN3hgKZtcTwecTqdbsJJyxrzjYfNZoMXKbharbF52YLM93WNum4UtIbX6z+/v9eCrTDI8gJhGCJJUkGCKIrVy1vXVYZlWcJ1PZHooSh2ymZsAs1ng85MBU1zXuWdkeEHDxfLJR4ePmHy+Iinp8+YPj9jNvuOr99m+DKdYjKZ4MfPX+KlpEG7vteudl2n/r6HQyaLxRLzxQKu54FNsrZSD4uiQC4Y/bslVyVTVhhG0lmjzaBsFmKm7ilw1cMgCLUJ9GcvcoimGX06/VsOydBIQUqn6cwcwb1OAA/Qg2rd68TYYUqGSdpJ4/ic7zhkxphQNpmOiONYYxQEgRwYwDcGmQS9l4BfIN72/bj2Gn6HJxjJIEPNyWiFXSGNMSZEKAfNlysEsibyW5rnwqZEmmZ62FXJlEaqjANp98OI8bSmaVXSmLvXE/L3YEsRzi4lUXYURXrPfZKmGiXfBDrbuUzUQfLI5rFpV0ePBofi11Y+CrEUOEg4ySqKE5X6WyQbOSQXGwgSYFYZrbHgG8nsoH7fhm8bPRyDzJUHkNXds8xilMhgByLTlT2bMvqoq+BNdwccr0AZMneaNeJVFtmUC9r78Ad+rrcXONcj1wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;s3 batch operations filter&quot;
        title=&quot;s3 batch operations filter&quot;
        src=&quot;/static/c843c7462b1235dfc0bb2a0bcf616a43/fcda8/s3-batch-operations-filter.png&quot;
        srcset=&quot;/static/c843c7462b1235dfc0bb2a0bcf616a43/12f09/s3-batch-operations-filter.png 148w,
/static/c843c7462b1235dfc0bb2a0bcf616a43/e4a3f/s3-batch-operations-filter.png 295w,
/static/c843c7462b1235dfc0bb2a0bcf616a43/fcda8/s3-batch-operations-filter.png 590w,
/static/c843c7462b1235dfc0bb2a0bcf616a43/c8e86/s3-batch-operations-filter.png 758w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Some other weird script could also be a potential solution? Adios for now.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Process Monitoring on Windows EC2 Instances With Procstat]]></title><description><![CDATA[Earlier this week, my client approached me with an interesting problem. They had two EC2 Windows instances that ran the SAP IDM Solution…]]></description><link>https://www.hitarthasrani.com/2022-11-25-aws-windows-procstat-monitoring/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2022-11-25-aws-windows-procstat-monitoring/</guid><pubDate>Fri, 20 Jan 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Earlier this week, my client approached me with an interesting problem. They had two EC2 Windows instances that ran the SAP IDM Solution. One was for the IDM application (Win Server 2022) and one for the SQL database (Win Server 2019 with SQL). Their request: &lt;em&gt;Can we get alerted when the application process or the database process shuts down but the instance will still be running?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In simpler terms, monitor this process running on my instance and notify me when this process stops.&lt;/p&gt;
&lt;p&gt;The architecture of the overall solution looks something like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/b904a/architecture.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAC4jAAAuIwF4pT92AAABVUlEQVQY02VRu0oDQRTNj/gRFpYWNoJfYGFjo5WNjWAhiIWiWFgYrUQEI1imCQpLxCcY1yImRDBi2DxcdslmNbs7+5jHcXaCYvTCZYZ77jlz59yMEAJ/g3P+c/+PAkm3id7FAXjkg4c+RBRC0ASCM2TShkddR6GQR7F4Bv3hXpGI58DtlFN5CMYR3NQQFytAyJB8mvi4PQHtd0FJD6HbQEIcKcgHgseH+5iZHMP0xCg2N1aV4PXpIs7XR+C1rxD7As/jSzCn1kCqDaTzM6eF4EkDJ68wyjvwTE3xlKCWzyG7PI+9lTnkjnYVYNQuUdW25csW4iBGaXYLtYUsiGEp3O40YdRfEHtvsOs5hE5J+aMEbdNARb9Do16GY7cVgcoxIio/LJuY9MYlHrp9F0x6LhiFZVlott4R+B44jcCSSNUz30tJid8LGNR+53AM4YKrTP0T8vwCTKK5xypOe/UAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;architecture diagram&quot;
        title=&quot;architecture diagram&quot;
        src=&quot;/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/fcda8/architecture.png&quot;
        srcset=&quot;/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/12f09/architecture.png 148w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/e4a3f/architecture.png 295w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/fcda8/architecture.png 590w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/efc66/architecture.png 885w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/c83ae/architecture.png 1180w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/b904a/architecture.png 2175w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It can be broken down into 3 parts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The EC2 Instance(s). These had already been created earlier&lt;/li&gt;
&lt;li&gt;The CloudWatch Agent&lt;/li&gt;
&lt;li&gt;The SNS Topic&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Right now, I only want to worry about the Cloudwatch Agent as configuring the Ec2 instance and the SNS topic are relatively easy.&lt;/p&gt;
&lt;p&gt;Now, the First thing that comes to my mind when talking about monitoring an EC2 instance is using the Cloudwatch agent, as this is AWS’s OOTB (out of the box) solution for monitoring anything with EC2.&lt;/p&gt;
&lt;p&gt;We can also customise the cloudwatch agent to collect specifc metrics based on what we require using a json template.&lt;/p&gt;
&lt;p&gt;So if I can monitor my app and db processes using the cloudwatch agent, I don’t need to look at&lt;/p&gt;
&lt;p&gt;But then…can we even monitor a process with the cloudwatch agent?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 493px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/89cfa2d3d60790a9856b4dc638df0c6d/f88d0/can-we-monitor-it.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 165.54054054054052%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAhCAYAAADZPosTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAIBUlEQVRIx52Wd1RVVxbGb2acZWKJWZaoJEpoBlREREyQoogBEaRIEYRHHqhRUVFExIgkaqw0YyDgKIggjyZWEBXbIGIZLCAIYgNBAemKHfQ3916TzD9Z+SN3rb3OPufs/e1vf+e8dZ4w2i8TDU8Vn7lnYbEkHq+wnxirjEN9dhYjFOkMdkhgddRxaupbSVQd4vT561TXd3Awr4Ds3DOoso9z/1E7FdWtWCzIQtAXAdXcMwiO8uN24TAu71EjIUSHmfOWM1xxgAE2sURsy6HrdSeOTo5s2byRs2dPk65KYdXK5XjOcqW16RHS982iTARd5T6+8tvJzRx/yjLXUZoaw4kwX9IX2TJNGU3/6QmErEmls62JpIQkkpJSyc46wKEj+Rw7fZHUjCM0dXTR9rSbqYsyEL5UZmKzMIXE6BRKs1I4vD6E5AU+hPqHYaBIRtNtN59or2DT+hXU75tKfvQsimOduaHy4WLmcs6nBpO7Zw0rFgai6xCHoOOTxRg/Fas3RLNvZyw53+mxa843+C3agJ1bKFoee+mrvoyvjF0JcJ6IYqoFfjYWLLA1xc/aBF8rE9E3Z7TWdHSddiF4rVZRFD2Toz+5U137gDtXDpGbm0HQxkS22+mxZq4CDbcU1GYkM8A+jU/tUxlop2KQvQo1B5V4aOkMdUpj+MxUDPzElmcEpnAhdg65vywmPHIdeddr2ZCSxyRnXzZ525O5xpFZq7aiDN2Ea3Ak1gG/4hsWwWT/HfiGhOG2LAyzOZF4B4Wg+D4aQdMrneCQeHaHh7E1dAlb1gax0NsBP8dpLPbwxtE3Em2PHRj6/IKeVzzqztvRnxWOhnsimi4xaLv9LLKLQcvlZ0Z670a4XFFPQckDyu7WU9/SRm3bM65V1VBcdovLN+s4W9rAubL69+ONBgpu1JGaUyT6Dzlf3kihaEXlDRSWNXLxZgMCf+Nrb31M95sXf7ondHV309XVTbc4vn37VjbJl9a7Rb+rW5q/H9+86ZKTrly5Kl7u/8j++9y38ijF/C2GOTk5lJeX/znD6upqbt++TU1NDQ8fPkSaS6Nk7969o7GxkZcvX8pzKaauro5Hjx7JcbW1tTQ3N/P69Wvu3r1LQ4OooVTp4sWL3Lp1i9bWVjmooqKCBw8eiG10cePGDdrb27l586YMJsXduXOH+/fvy0QkEKng1atX5Zw/Wpa0KykpoaOjQwYoLi6Wq0rzFy9ecO/ePTlBKiixq6qqkllL4E+fPv1/y7870qIE+OTJE9mk6lKCtP7mzRuZnQT6e+uVlZVy6xJgZ2fnH4cpSFWltiQ2UhtFRUXyhjSX2igtLZU1krSUAKVCEtilS5fkPckkiSRJpHWhqalJriQxae9o59q1azx//lxm2dLSIu+9evWSx48fy3pJjB6Iv/m6utrfDq9OjmtuaZYx/vLalJSUkZ9/iuLL/6WyopLysnIei0z/6hOePWmho71NZNQhHkA7HW0tvHzewutXbbS11lBWVkzl3Ts0tDymvbOVzpfPZWtqa6axWezsmcjsmZj/vI3OVx0Idl4TmTbdDLsZFtjOMGfSlPEo3bRRxaoTt1mNmFhD4jON2H1wMvtPKym+v4iT5T4k5vuwVvUdK3e5YB+gibW/Hm6rTBDGTR6N0QRtJkzUwtB4ODr6Ggwe1IsgL4FjB8wpvGzHuVMChzI+ZFt4D06f7Ele3gfsz+7HrrTxhP17Ho6rbNF3781Yz08QTMzHYmI+CiNjbQzHf4GNnSkaOl9wME1fVMSKqkotLpz5gMOZfcjPHci5E73Ize5B1t5/okr8BzFxmqyMXYx7qAsW89QQTL8axsixw7F3Hs/OKPGR2pnM/h8cxGtiSEvTMOrv96Omsi/Xr+pQ36TkdrU9RQWDOX6wJwdUH5K0419sijRi4Y8ObNtojbDt+/4s9etBRf562g/kcS0wmBQbPTbbfMRGx4/Z6taHbcq+/LKsH3GhQ0iK+pw9MX3Zm9CD1JSPSNzVW3xmNVm2Wpc1Cm2E+M19OZ88gZJ1qzmhmM2Ob0z54bPP+XHQAJINRpI10YSMSZNJNjchycyE6An6REwZRbT9SCLd1NmyQI31wWoEBw1hpXIIgqvvcArWL+SUt4KtZgakzZ7FHit7gkeMoMTVg3v+i6kKWEp1UDD3xHdjsbEZ2V5KSucuId9JScY0N8ItLbEa+QnzrUchzA00JdfXhxwXB0KMdTnq4sY5ew+yLady3t2Vy76+HHdy5oJCQcmC+Zz61pdCpR/nvZUcd/cmy9Gd2Mm2+GhqkaOcK2qosOCIhzOZ061YradOlJUGWU7jOGRlicp6ErEWRqROs6Rgtqdspz1cOTbLmSMujqTZ27LD0oJII0MidfU54uCOcFjU6LCzAxGGBvgP60+oZi8ixwwkxkCHBFMjYs3GET/FnJ1TJ4ntWZJhO4mUqabsNBvP9q/HET5Wl03jNAk2Hcy86cMQtmppsX30SIL79Seg54cs1dUgzHgi/iYTWWgsJnm6st1jJr+6TidJ6Um8pwtRrk5EinIsMTBmtu4Itgdok7qhD/u2iIBzrdXx1+zD/H69mdNTINLHmaNnznI0L5fQtRHi3WvkZEEBoYGB5BcWUn6niuul18jOTkPpv5lRw835Tn0QG4d8zC5t8dq4B5owf/HXzB7zGV5De+H16WCCnexYFbCKoIgjbApPJmHFUrY62RD37TziAkP5KUL8c7AlHSefKBT9ddihO5DjFkPJHPMl/wPqAUhN0bPisAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Can we monitor it?&quot;
        title=&quot;Can we monitor it?&quot;
        src=&quot;/static/89cfa2d3d60790a9856b4dc638df0c6d/f88d0/can-we-monitor-it.png&quot;
        srcset=&quot;/static/89cfa2d3d60790a9856b4dc638df0c6d/12f09/can-we-monitor-it.png 148w,
/static/89cfa2d3d60790a9856b4dc638df0c6d/e4a3f/can-we-monitor-it.png 295w,
/static/89cfa2d3d60790a9856b4dc638df0c6d/f88d0/can-we-monitor-it.png 493w&quot;
        sizes=&quot;(max-width: 493px) 100vw, 493px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Say hello to the procstat plugin! It can collect metrics from your specified process and is available to use in the CloudWatch agent. From the amazon docs (linked below), it is supported on servers running Linux and on servers running Windows Server 2012 or later.&lt;/p&gt;
&lt;p&gt;The docs have an example on how I can configure this so I can just add that part to my agent. Looking at the metrics, there’s a few ways I can tackle this. The most obvious way to check (and verify that this is the right process) was to read the &lt;code class=&quot;language-text&quot;&gt;pid&lt;/code&gt; or process identifier using and compare it with the actual identifier in the server.&lt;/p&gt;
&lt;p&gt;The final cloudwatch agent json file looks something like this. (Example for Database/SQL Server and Agent)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &quot;metrics&quot;: {
        &quot;namespace&quot;: &quot;custom_proc_monitor&quot;,
        &quot;aggregation_dimensions&quot;: [
            [
                    &quot;InstanceId&quot;
            ]
        ],
        &quot;append_dimensions&quot;: {
            &quot;InstanceId&quot;: &quot;${aws:InstanceId}&quot;
        },
        &quot;metrics_collected&quot;: {
            &quot;procstat&quot;: [
                {
                    &quot;exe&quot;: &quot;sqlservr&quot;,
                    &quot;measurement&quot;: [
                        &quot;pid&quot;,
                        &quot;memory_vms&quot;,
                        &quot;memory_rss&quot;
                    ]
                },
                {
                    &quot;exe&quot;: &quot;SQLAGENT&quot;,
                    &quot;measurement&quot;: [
                            &quot;pid&quot;,
                            &quot;memory_vms&quot;,
                            &quot;memory_rss&quot;
                    ]
                }
            ]
        }
    }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Under &lt;code class=&quot;language-text&quot;&gt;metrics_collected &gt; procstat&lt;/code&gt; you can see the exe name for the SQL Process and the measurements collected. Procstat is also collecting metrics for another process for the SQL Agent. This just means I can send a notification when either the SQL Server process or the SQL agent fails on that server.&lt;/p&gt;
&lt;p&gt;Once the instance has the updated cloudwatch agent, it should start sending in some data for the processes.&lt;/p&gt;
&lt;h2&gt;Gotchas!&lt;/h2&gt;
&lt;p&gt;Like always, things may not go smoothly in the first try. Using the agent and testing it was easy enough but I did have a few things that didn’t go as expected.&lt;/p&gt;
&lt;p&gt;Obviously, windows does not want to use the same “exe name” for the process. I first took the process name from Task manager &gt; Additional processes.&lt;/p&gt;
&lt;p&gt;This exe name did not seem to always work for me, especially for my application server running SAP IDM. I ended up finding the process name by running the &lt;code class=&quot;language-text&quot;&gt;get-process&lt;/code&gt; command on powershell and comparing the PID with the process/exe name on task manager. In the cloudwatch agent, using the process name given this command seems to do the trick. I can also use the pid info displayed by the command to check if Cloudwatch is getting the right information from procstat.&lt;/p&gt;
&lt;h2&gt;Additional Reading&lt;/h2&gt;
&lt;p&gt;(AWS Docs) Collect process metrics with the procstat plugin. &lt;a href=&quot;https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-procstat-process-metrics.html&quot;&gt;https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-procstat-process-metrics.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;GitHub Code for an exmaple in terraform &lt;a href=&quot;https://github.com/RubberDuckDestroyer/windows-process-monitoring-aws-terraform&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[VIDEO] Using AWS Migration Hub]]></title><description><![CDATA[YouTube Link: https://youtu.be/GM2kLYc8-Bw]]></description><link>https://www.hitarthasrani.com/2022-06-06-aws-twitch-stream/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2022-06-06-aws-twitch-stream/</guid><pubDate>Mon, 06 Jun 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;YouTube Link: &lt;a href=&quot;https://youtu.be/GM2kLYc8-Bw&quot;&gt;https://youtu.be/GM2kLYc8-Bw&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using AWS IAM Policy Simulator to debug IAM Policy Issues]]></title><description><![CDATA[In this blog, we’ll discuss debugging AWS IAM Policies and KMS Policies using a tool I didn’t notice earlier. The other day I was having…]]></description><link>https://www.hitarthasrani.com/2022-03-23-aws-iam-policy-simulator/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2022-03-23-aws-iam-policy-simulator/</guid><pubDate>Wed, 23 Mar 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this blog, we’ll discuss debugging AWS IAM Policies and KMS Policies using a tool I didn’t notice earlier.&lt;/p&gt;
&lt;p&gt;The other day I was having some trouble debugging some issues with AWS Config throwing “Access Denied” errors.
I asked a senior engineer from my team to help me debug this issue. After debugging the issue a bit, we realised that the AWS IAM Role attached to AWS Config was trying to use KMS to encrypt data and did not have access to the key.
My coworker then introduced me to the IAM Policy Simulator which allowed me to debug and recitfy the IAM permissions quickly.&lt;/p&gt;
&lt;p&gt;I have set up a test environment to showcase the IAM Policy Simulator’s capabilities.&lt;/p&gt;
&lt;p&gt;AWS Resources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AWS Config, set up using the one-click option. &lt;em&gt;Note -  In this scenario, we only use this to get the IAM Role. You can create a dummy role to test the IAM Role/Policy.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;A Symmetric KMS key with some permissions that allow some SSO Users to use it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The AWS Config recorder is using the following role:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/66b7f12a21b38ee627f03bab64549b77/d777c/policysim-iam-policy2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVQoz4VS2W6EMAzM/39c1YdK+4BEK3aBQLiyXOGcZtyCeq1qaeQoPmZiRxljkOc5yrJEmqbQWqMoCuz7DtrhH9kRb9sWTdNA8fAo8cC6roKhdxhHh23bzruj4bIsPjZC2fsdzjlM0/StyVdjvKoqPD9d8BbGktv3PcZh+FWjxqmXA1kPkPnwNHoq+M/YVHVlhrtXSZCZagbPTN913fms8+meaGFeaTC3Vu5YR1CESlIti6jrGr1vxDkwOM+zqOKZd4Rz3nsiW5UwlxfU0Ss4Mi41SRIRoHSa4Hq9Ics/tp17z41z+9w6z9w6C6IoQpZlkmO8Zw7jnC9zZMtdU+Cmcxg7evmLKCOojAQcPp9F9uyzCYulmW/EUVlr5duwToVhiCAI5Nks+AtUQXaCo/kJEsRxLE3fASpbtvOQEMUwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;test role here&quot;
        title=&quot;test role here&quot;
        src=&quot;/static/66b7f12a21b38ee627f03bab64549b77/fcda8/policysim-iam-policy2.png&quot;
        srcset=&quot;/static/66b7f12a21b38ee627f03bab64549b77/12f09/policysim-iam-policy2.png 148w,
/static/66b7f12a21b38ee627f03bab64549b77/e4a3f/policysim-iam-policy2.png 295w,
/static/66b7f12a21b38ee627f03bab64549b77/fcda8/policysim-iam-policy2.png 590w,
/static/66b7f12a21b38ee627f03bab64549b77/efc66/policysim-iam-policy2.png 885w,
/static/66b7f12a21b38ee627f03bab64549b77/c83ae/policysim-iam-policy2.png 1180w,
/static/66b7f12a21b38ee627f03bab64549b77/d777c/policysim-iam-policy2.png 1555w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This role gives my AWS resource, in this case my AWS Config Recorder, the following AWS Managed permissions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Read-Only access to AWS Services and resources&lt;/li&gt;
&lt;li&gt;A Default Policy for the AWS Config service so that AWS Config can track changes across my acount.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The KMS Key is set up with the following permissions:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Id&quot;: &quot;key-consolepolicy-3&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;Allow access for Key Administrators&quot;,
            *REDACTED*
        },
        {
            &quot;Sid&quot;: &quot;Allow Config to use this key&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Principal&quot;: {
                &quot;Service&quot;: &quot;config.amazonaws.com&quot;
            },
            &quot;Action&quot;: &quot;kms:GenerateDataKey*&quot;,
            &quot;Resource&quot;: &quot;*&quot;,
            &quot;Condition&quot;: {
                &quot;ArnLike&quot;: {
                    &quot;aws:SourceArn&quot;: &quot;arn:aws:iam::**********:role/aws-controltower-ConfigRecorderRole&quot;
                }
            }
        }
    ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see that this key already has permissions to allow the above topic to run &lt;code class=&quot;language-text&quot;&gt;KMS:GenerateDataKey*&lt;/code&gt; using the key.&lt;/p&gt;
&lt;p&gt;Jumping back to the &lt;code class=&quot;language-text&quot;&gt;aws-controltower-ConfigReecorderRole&lt;/code&gt; on the AWS IAM Dashboard, you can see a button that says &lt;strong&gt;Simulate&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7de992dfda60d6a28dc68d50fa29ccbd/e405b/policysim-iam-policy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVQY01VPuxKDMAzj/3+vQ5cOPbgrDSFA3jwCauQu7eCTLDuR3GRrkNwM5z1yztj3HTFGrOuKEIL013XhPE+pLy847IwSvWjHcUhx1phpxlspTNOElBK2bZNPuFBKEU5NdGLtg7Uw9xvs8wHvHMZxxDAMstMYY9C2LV59LyKLGg3IiSxVedd1ommtoWuIUf/v+nplw9P08EKrZsS8igs1Ip35gCmZvv8xpQHntqZdlkWQV30AE9cyeaEVrnwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Simualtor Button on IAM Role&quot;
        title=&quot;Simualtor Button on IAM Role&quot;
        src=&quot;/static/7de992dfda60d6a28dc68d50fa29ccbd/fcda8/policysim-iam-policy.png&quot;
        srcset=&quot;/static/7de992dfda60d6a28dc68d50fa29ccbd/12f09/policysim-iam-policy.png 148w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/e4a3f/policysim-iam-policy.png 295w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/fcda8/policysim-iam-policy.png 590w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/efc66/policysim-iam-policy.png 885w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/c83ae/policysim-iam-policy.png 1180w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/e405b/policysim-iam-policy.png 1566w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you click this, it will take you to the IAM Policy Simulator. Alternatively, you can jump into the Policy Simulator from the IAM Dashboard here.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4d352effd2f7c9ff932c62669c0ae0c1/f470a/policysim-iam-dashboard.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVQoz3VQy24TQRD0H3KOgsQpEbmAyGdwIxEHEiQev8CVCCk3EuVFbOWwMjHGstee3dn17O48dman6Bkb5wAZqTTdperu6u5lOcdo/BsF55hxiZcfbvHqUz9i//MALz72sXt0jZ1313h+fIO99zd49vYKW28usH14he2DSzw9vMST12f4cj5Fr6kq1HUNZQHnAXQGgjOIggGtJCKQj73uH6ZX5Aw8Y7DWRkKKCuksRbognqB4gdZ1MK2NsBS7zlPcYr7IMOgnWC7ryLmuQ6+umxhg7cUqRQMyLIWA1hramPiHgc45eP/gePRzgtNvF6RxK7+hoaDCsig2QkXFnPLgIAgC/jYKTUNu1kOSZISTr99x2x9iOmWrlfMsB2Ns07DRFsrYOFXq4KpDLnRcSWoaQrpa6rjPkuqSH3cYDhLMx1P4ztEN6UZlWW7WkFIiI2HbmjXj//s768DTOcqqgXctvFHwslk1LMoirhDEilwMZwITVpEzumfdIq9MRBYgDBiBU1ymM4zv7zH5NSK3C3it8AcIglp1C5Iz4gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IAM Dashboard&quot;
        title=&quot;IAM Dashboard&quot;
        src=&quot;/static/4d352effd2f7c9ff932c62669c0ae0c1/fcda8/policysim-iam-dashboard.png&quot;
        srcset=&quot;/static/4d352effd2f7c9ff932c62669c0ae0c1/12f09/policysim-iam-dashboard.png 148w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/e4a3f/policysim-iam-dashboard.png 295w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/fcda8/policysim-iam-dashboard.png 590w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/efc66/policysim-iam-dashboard.png 885w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/c83ae/policysim-iam-dashboard.png 1180w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/f470a/policysim-iam-dashboard.png 1443w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Once you are on the Policy Simulator Page, you can select&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The IAM User, Group or Role to use.&lt;/li&gt;
&lt;li&gt;The Service you need permission to.&lt;/li&gt;
&lt;li&gt;Specific Service actions you would like to use.&lt;/li&gt;
&lt;li&gt;Action settings -  you can provide resource ARN’s here.&lt;/li&gt;
&lt;li&gt;Run the Simulation&lt;/li&gt;
&lt;li&gt;View the Simulation results.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7adf31c59a21a08709be1442b5599eb9/d8c86/policysim-denied.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVQY032Qu04DMRBF9+dBFKHLJ1BQEBGgRAJFfAASSDSU7CbZlzf2vh07B9soCMJjpNFobM/xvRPlWcYyEzw8v3H3mPD0mrFerYiXFX0/kBcNm02FlAprbcjdbkfbtpRCYLaatdTcvgwoDVEcx6TrFXWtGIcBqRqSZEma5SilHEy63FBVVejruqZpGvdZH+picc/scs7Z+Zz51TWR1iM+xq0NtRA9cZIinaqyLCmKIgxLKRFOkQfmeU7btYhUMLu4YTI55eT4iOl0SuQfdF0XrBhj0No4S4Teh7f3V5itu/dixtGtoHOcnsjb8cA9xFrzY9BDf8uPsN/efQL3C/cq/4N8hR2e+dl3KXXKjOyG9kUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IAM Policy Simulator&quot;
        title=&quot;IAM Policy Simulator&quot;
        src=&quot;/static/7adf31c59a21a08709be1442b5599eb9/fcda8/policysim-denied.png&quot;
        srcset=&quot;/static/7adf31c59a21a08709be1442b5599eb9/12f09/policysim-denied.png 148w,
/static/7adf31c59a21a08709be1442b5599eb9/e4a3f/policysim-denied.png 295w,
/static/7adf31c59a21a08709be1442b5599eb9/fcda8/policysim-denied.png 590w,
/static/7adf31c59a21a08709be1442b5599eb9/efc66/policysim-denied.png 885w,
/static/7adf31c59a21a08709be1442b5599eb9/c83ae/policysim-denied.png 1180w,
/static/7adf31c59a21a08709be1442b5599eb9/d8c86/policysim-denied.png 1663w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;A simulaton has already been run in the above screenshot. You can see the &lt;code class=&quot;language-text&quot;&gt;Access Denied&lt;/code&gt; result with some additional information.&lt;/p&gt;
&lt;p&gt;Now I have enough information to create a custom IAM Policy I can attach to this role. I can also quickly test the custom policy on the role using the simulator.&lt;/p&gt;
&lt;p&gt;Here’s a result once the right policy has been attached.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/07a9c/policysim-success.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVQY05WPwU7DMBBE8///wg9w4sQJqUJI0BZaqbR146SJ7cZOmjjJw7YoB04w0mhs7+54NjuXBat9xf3iwOO6ZrkrEcc9pzynaRr6vudyuaCUoq5rvPfM8/x9V2it2Bxr7p4KHt4qsvf3NeKwx18tTB7rWoQQ5MGwqiqcc8lQa51MrLWJ0Tzq1VmcddTaoZuOTFYabQxKG0wTml2XzOJApJQSE+qRt/eosixRuy3y9ZkmqPvc0u8+yLqQIGGeYBzxw5DWbNuWIZy7rksa1xxD/aYRYxsCnAVtKXFFjjeKTL0sMOGXfrvCb5b4QvAXROPfCJHITrkkF0d8SDX5ISTsfwb+y2ka+QJdh8zEkv76FAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Policy Simulator Passed&quot;
        title=&quot;Policy Simulator Passed&quot;
        src=&quot;/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/fcda8/policysim-success.png&quot;
        srcset=&quot;/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/12f09/policysim-success.png 148w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/e4a3f/policysim-success.png 295w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/fcda8/policysim-success.png 590w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/efc66/policysim-success.png 885w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/c83ae/policysim-success.png 1180w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/07a9c/policysim-success.png 1440w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;IAM Policy Simulator allows you to quickly debug and test IAM Policies attached to IAM Users, Groups or Roles against specific AWS resources. It saves time spent in manual testing by making this action one-click with instant results and is highly customizable.&lt;/p&gt;
&lt;p&gt;Big thanks to Martin Caarels, you can check out his blog &lt;a href=&quot;https://blog.caarels.com&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item></channel></rss>