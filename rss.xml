<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Hitarth Asrani]]></title><description><![CDATA[A blog ranting the cloud life.]]></description><link>https://www.hitarthasrani.com</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 22 Mar 2023 02:39:31 GMT</lastBuildDate><item><title><![CDATA[Amazon Linux 2023 just dropped]]></title><description><![CDATA[If you’re running workloads on the cloud, chances are you’re machines are running linux. RedHat, Fedora, Ubuntu, etc. There’s many flavours…]]></description><link>https://www.hitarthasrani.com/2023-03-21-amazon-linux-3/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2023-03-21-amazon-linux-3/</guid><pubDate>Tue, 21 Mar 2023 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;If you’re running workloads on the cloud, chances are you’re machines are running linux. RedHat, Fedora, Ubuntu, etc. There’s many flavours to choose from, but then again if you’re on AWS you’re probably familiar with Amazon Linux (AL). As part of their release schedule, AWS releases a new major version every 2 years and Amazon Linux 2023 (AL2023) just dropped in General availability on the 15th of March 2023.&lt;/p&gt;
&lt;p&gt;Amazon Linux is AWS’s rpm based linux distro for general purpose workloads and integrates with AWS services. It is designed for scale and LTS. From AL2023 onwards, AWS will release a new version of Amazon Linux every 2 years.&lt;/p&gt;
&lt;h2&gt;The Benefits&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Long Term Support&lt;/li&gt;
&lt;li&gt;Predictable Release Cycle - plan your upgrades and migrations&lt;/li&gt;
&lt;li&gt;Versioned repositories for AL2023 = more consistent OS updates.&lt;/li&gt;
&lt;li&gt;Security Upgrades and Compliance - SELinux is enabled by default on permissive mode (permission denials are logged but not enforced). You can also set security policies at boot time.&lt;/li&gt;
&lt;li&gt;OS Level Optimisations.&lt;/li&gt;
&lt;li&gt;Kernal Hardening and Live Patching.&lt;/li&gt;
&lt;li&gt;Use AL2023 at no additional cost as part of your EC2 package (Please check EC2 pricing).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;What should engineers know about AL2023?&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Standard support - 2023 &amp;#x26; 2024.&lt;/li&gt;
&lt;li&gt;Maintenance - 2025 - 2027.&lt;/li&gt;
&lt;li&gt;Package manager: dnf.&lt;/li&gt;
&lt;li&gt;Uses the XFS Filesystem on the root filesystem.&lt;/li&gt;
&lt;li&gt;Networking interfaces are managed by the &lt;code class=&quot;language-text&quot;&gt;systemd-networkd&lt;/code&gt; system service. Amazon Linux 2 used &lt;code class=&quot;language-text&quot;&gt;dhclient&lt;/code&gt; previously.&lt;/li&gt;
&lt;li&gt;OpenSSL 3 - The Open Secure Socket Layer v3 (OpenSSL) cryptography toolkit is available. It uses the SSL v2/vv3 and TLS v1 network protocols and the required cryptography standards.&lt;/li&gt;
&lt;li&gt;IMDSv2 - Any instances launched with AL2023 will require the use of IMDS v2 and the default hop limit will be set to 2 to help with containerised workloads. This can be manually overridden if needed.&lt;/li&gt;
&lt;li&gt;Check support info on a specific package: &lt;code class=&quot;language-text&quot;&gt;sudo dnf supportinfo --packagename&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Check support info on all installed packages: &lt;code class=&quot;language-text&quot;&gt;sudo dnf supportinfo --show installed&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Customise cloud-init to configure them dynamically: Create your cloud-init action files in &lt;code class=&quot;language-text&quot;&gt;/etc/cloud/cloud.cfg.d&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Networking configurations generated in: &lt;code class=&quot;language-text&quot;&gt;/run/systemd/network&lt;/code&gt;. You can add custom config files to &lt;code class=&quot;language-text&quot;&gt;/run/systemd/network&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;/etc/systemd/network&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Python 3.9 (System Python) has security support until March 2028&lt;/li&gt;
&lt;li&gt;AL2023 is based on Fedora, but not any single release - there are components from more than one release of Fedora -  some of which are modified.  Other components more closely resemble the components in CentOS Stream 9 or were developed independently.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;AWS Integration is still a work in progress for some services (CodeDeploy,Inspector as of writing this), check the GitHub pages for known issues&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There’s a lot to take in for this new OS which will most likely be the default OS you use for general purpose workloads on AWS. As with anything else in technology, there will always be bugs. Check the known issues, plan and prepare yourself before committing to any different tech, especially when it comes to Operating Systems.&lt;/p&gt;
&lt;h2&gt;References&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Discussion forum: &lt;a href=&quot;https://forums.aws.amazon.com/forum.jspa?forumID=228&quot;&gt;https://forums.aws.amazon.com/forum.jspa?forumID=228&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Github Issues Page: &lt;a href=&quot;https://github.com/amazonlinux/amazon-linux-2023/issues&quot;&gt;https://github.com/amazonlinux/amazon-linux-2023/issues&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Known Issues: &lt;a href=&quot;https://docs.aws.amazon.com/linux/al2023/release-notes/relnotes-20230315.html&quot;&gt;https://docs.aws.amazon.com/linux/al2023/release-notes/relnotes-20230315.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Roadmap: &lt;a href=&quot;https://github.com/amazonlinux/amazon-linux-2023/projects/1&quot;&gt;https://github.com/amazonlinux/amazon-linux-2023/projects/1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Amazon Linux 2023 home page: &lt;a href=&quot;https://aws.amazon.com/linux/amazon-linux-2023/&quot;&gt;https://aws.amazon.com/linux/amazon-linux-2023/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;AL2023 packages: &lt;a href=&quot;https://docs.aws.amazon.com/linux/al2023/release-notes/all-packages.html&quot;&gt;https://docs.aws.amazon.com/linux/al2023/release-notes/all-packages.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Process Monitoring on Windows EC2 Instances With Procstat]]></title><description><![CDATA[Earlier this week, my client approached me with an interesting problem. They had two EC2 Windows instances that ran the SAP IDM Solution…]]></description><link>https://www.hitarthasrani.com/2022-11-25-aws-windows-procstat-monitoring/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2022-11-25-aws-windows-procstat-monitoring/</guid><pubDate>Fri, 25 Nov 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Earlier this week, my client approached me with an interesting problem. They had two EC2 Windows instances that ran the SAP IDM Solution. One was for the IDM application (Win Server 2022) and one for the SQL database (Win Server 2019 with SQL). Their request: &lt;em&gt;Can we get alerted when the application process or the database process shuts down but the instance will still be running?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In simpler terms, monitor this process running on my instance and notify me when this process stops.&lt;/p&gt;
&lt;p&gt;The architecture of the overall solution looks something like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/b904a/architecture.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAC4jAAAuIwF4pT92AAABVUlEQVQY02VRu0oDQRTNj/gRFpYWNoJfYGFjo5WNjWAhiIWiWFgYrUQEI1imCQpLxCcY1yImRDBi2DxcdslmNbs7+5jHcXaCYvTCZYZ77jlz59yMEAJ/g3P+c/+PAkm3id7FAXjkg4c+RBRC0ASCM2TShkddR6GQR7F4Bv3hXpGI58DtlFN5CMYR3NQQFytAyJB8mvi4PQHtd0FJD6HbQEIcKcgHgseH+5iZHMP0xCg2N1aV4PXpIs7XR+C1rxD7As/jSzCn1kCqDaTzM6eF4EkDJ68wyjvwTE3xlKCWzyG7PI+9lTnkjnYVYNQuUdW25csW4iBGaXYLtYUsiGEp3O40YdRfEHtvsOs5hE5J+aMEbdNARb9Do16GY7cVgcoxIio/LJuY9MYlHrp9F0x6LhiFZVlott4R+B44jcCSSNUz30tJid8LGNR+53AM4YKrTP0T8vwCTKK5xypOe/UAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;architecture diagram&quot;
        title=&quot;architecture diagram&quot;
        src=&quot;/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/fcda8/architecture.png&quot;
        srcset=&quot;/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/12f09/architecture.png 148w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/e4a3f/architecture.png 295w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/fcda8/architecture.png 590w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/efc66/architecture.png 885w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/c83ae/architecture.png 1180w,
/static/2ee4f4ec8d08c6717a18f91fa3c7d4ff/b904a/architecture.png 2175w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;It can be broken down into 3 parts:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The EC2 Instance(s). These had already been created earlier&lt;/li&gt;
&lt;li&gt;The CloudWatch Agent&lt;/li&gt;
&lt;li&gt;The SNS Topic&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Right now, I only want to worry about the Cloudwatch Agent as configuring the Ec2 instance and the SNS topic are relatively easy.&lt;/p&gt;
&lt;p&gt;Now, the First thing that comes to my mind when talking about monitoring an EC2 instance is using the Cloudwatch agent, as this is AWS’s OOTB (out of the box) solution for monitoring anything with EC2.&lt;/p&gt;
&lt;p&gt;We can also customise the cloudwatch agent to collect specifc metrics based on what we require using a json template.&lt;/p&gt;
&lt;p&gt;So if I can monitor my app and db processes using the cloudwatch agent, I don’t need to look at&lt;/p&gt;
&lt;p&gt;But then…can we even monitor a process with the cloudwatch agent?&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 493px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/89cfa2d3d60790a9856b4dc638df0c6d/f88d0/can-we-monitor-it.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 165.54054054054052%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,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&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Can we monitor it?&quot;
        title=&quot;Can we monitor it?&quot;
        src=&quot;/static/89cfa2d3d60790a9856b4dc638df0c6d/f88d0/can-we-monitor-it.png&quot;
        srcset=&quot;/static/89cfa2d3d60790a9856b4dc638df0c6d/12f09/can-we-monitor-it.png 148w,
/static/89cfa2d3d60790a9856b4dc638df0c6d/e4a3f/can-we-monitor-it.png 295w,
/static/89cfa2d3d60790a9856b4dc638df0c6d/f88d0/can-we-monitor-it.png 493w&quot;
        sizes=&quot;(max-width: 493px) 100vw, 493px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Say hello to the procstat plugin! It can collect metrics from your specified process and is available to use in the CloudWatch agent. From the amazon docs (linked below), it is supported on servers running Linux and on servers running Windows Server 2012 or later.&lt;/p&gt;
&lt;p&gt;The docs have an example on how I can configure this so I can just add that part to my agent. Looking at the metrics, there’s a few ways I can tackle this. The most obvious way to check (and verify that this is the right process) was to read the &lt;code class=&quot;language-text&quot;&gt;pid&lt;/code&gt; or process identifier using and compare it with the actual identifier in the server.&lt;/p&gt;
&lt;p&gt;The final cloudwatch agent json file looks something like this. (Example for Database/SQL Server and Agent)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &quot;metrics&quot;: {
        &quot;namespace&quot;: &quot;custom_proc_monitor&quot;,
        &quot;aggregation_dimensions&quot;: [
            [
                    &quot;InstanceId&quot;
            ]
        ],
        &quot;append_dimensions&quot;: {
            &quot;InstanceId&quot;: &quot;${aws:InstanceId}&quot;
        },
        &quot;metrics_collected&quot;: {
            &quot;procstat&quot;: [
                {
                    &quot;exe&quot;: &quot;sqlservr&quot;,
                    &quot;measurement&quot;: [
                        &quot;pid&quot;,
                        &quot;memory_vms&quot;,
                        &quot;memory_rss&quot;
                    ]
                },
                {
                    &quot;exe&quot;: &quot;SQLAGENT&quot;,
                    &quot;measurement&quot;: [
                            &quot;pid&quot;,
                            &quot;memory_vms&quot;,
                            &quot;memory_rss&quot;
                    ]
                }
            ]
        }
    }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Under &lt;code class=&quot;language-text&quot;&gt;metrics_collected &gt; procstat&lt;/code&gt; you can see the exe name for the SQL Process and the measurements collected. Procstat is also collecting metrics for another process for the SQL Agent. This just means I can send a notification when either the SQL Server process or the SQL agent fails on that server.&lt;/p&gt;
&lt;p&gt;Once the instance has the updated cloudwatch agent, it should start sending in some data for the processes.&lt;/p&gt;
&lt;h2&gt;Gotchas!&lt;/h2&gt;
&lt;p&gt;Like always, things may not go smoothly in the first try. Using the agent and testing it was easy enough but I did have a few things that didn’t go as expected.&lt;/p&gt;
&lt;p&gt;Obviously, windows does not want to use the same “exe name” for the process. I first took the process name from Task manager &gt; Additional processes.&lt;/p&gt;
&lt;p&gt;This exe name did not seem to always work for me, especially for my application server running SAP IDM. I ended up finding the process name by running the &lt;code class=&quot;language-text&quot;&gt;get-process&lt;/code&gt; command on powershell and comparing the PID with the process/exe name on task manager. In the cloudwatch agent, using the process name given this command seems to do the trick. I can also use the pid info displayed by the command to check if Cloudwatch is getting the right information from procstat.&lt;/p&gt;
&lt;h2&gt;Additional Reading&lt;/h2&gt;
&lt;p&gt;(AWS Docs) Collect process metrics with the procstat plugin. &lt;a href=&quot;https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-procstat-process-metrics.html&quot;&gt;https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/CloudWatch-Agent-procstat-process-metrics.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;GitHub Code for an exmaple in terraform &lt;a href=&quot;https://github.com/RubberDuckDestroyer/windows-process-monitoring-aws-terraform&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[VIDEO] Using AWS Migration Hub]]></title><description><![CDATA[YouTube Link: https://youtu.be/GM2kLYc8-Bw]]></description><link>https://www.hitarthasrani.com/2022-06-06-aws-twitch-stream/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2022-06-06-aws-twitch-stream/</guid><pubDate>Mon, 06 Jun 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;YouTube Link: &lt;a href=&quot;https://youtu.be/GM2kLYc8-Bw&quot;&gt;https://youtu.be/GM2kLYc8-Bw&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Using AWS IAM Policy Simulator to debug IAM Policy Issues]]></title><description><![CDATA[In this blog, we’ll discuss debugging AWS IAM Policies and KMS Policies using a tool I didn’t notice earlier. The other day I was having…]]></description><link>https://www.hitarthasrani.com/2022-03-23-aws-iam-policy-simulator/</link><guid isPermaLink="false">https://www.hitarthasrani.com/2022-03-23-aws-iam-policy-simulator/</guid><pubDate>Wed, 23 Mar 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In this blog, we’ll discuss debugging AWS IAM Policies and KMS Policies using a tool I didn’t notice earlier.&lt;/p&gt;
&lt;p&gt;The other day I was having some trouble debugging some issues with AWS Config throwing “Access Denied” errors.
I asked a senior engineer from my team to help me debug this issue. After debugging the issue a bit, we realised that the AWS IAM Role attached to AWS Config was trying to use KMS to encrypt data and did not have access to the key.
My coworker then introduced me to the IAM Policy Simulator which allowed me to debug and recitfy the IAM permissions quickly.&lt;/p&gt;
&lt;p&gt;I have set up a test environment to showcase the IAM Policy Simulator’s capabilities.&lt;/p&gt;
&lt;p&gt;AWS Resources:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;AWS Config, set up using the one-click option. &lt;em&gt;Note -  In this scenario, we only use this to get the IAM Role. You can create a dummy role to test the IAM Role/Policy.&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;A Symmetric KMS key with some permissions that allow some SSO Users to use it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The AWS Config recorder is using the following role:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/66b7f12a21b38ee627f03bab64549b77/d777c/policysim-iam-policy2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABOElEQVQoz4VS2W6EMAzM/39c1YdK+4BEK3aBQLiyXOGcZtyCeq1qaeQoPmZiRxljkOc5yrJEmqbQWqMoCuz7DtrhH9kRb9sWTdNA8fAo8cC6roKhdxhHh23bzruj4bIsPjZC2fsdzjlM0/StyVdjvKoqPD9d8BbGktv3PcZh+FWjxqmXA1kPkPnwNHoq+M/YVHVlhrtXSZCZagbPTN913fms8+meaGFeaTC3Vu5YR1CESlIti6jrGr1vxDkwOM+zqOKZd4Rz3nsiW5UwlxfU0Ss4Mi41SRIRoHSa4Hq9Ics/tp17z41z+9w6z9w6C6IoQpZlkmO8Zw7jnC9zZMtdU+Cmcxg7evmLKCOojAQcPp9F9uyzCYulmW/EUVlr5duwToVhiCAI5Nks+AtUQXaCo/kJEsRxLE3fASpbtvOQEMUwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;test role here&quot;
        title=&quot;test role here&quot;
        src=&quot;/static/66b7f12a21b38ee627f03bab64549b77/fcda8/policysim-iam-policy2.png&quot;
        srcset=&quot;/static/66b7f12a21b38ee627f03bab64549b77/12f09/policysim-iam-policy2.png 148w,
/static/66b7f12a21b38ee627f03bab64549b77/e4a3f/policysim-iam-policy2.png 295w,
/static/66b7f12a21b38ee627f03bab64549b77/fcda8/policysim-iam-policy2.png 590w,
/static/66b7f12a21b38ee627f03bab64549b77/efc66/policysim-iam-policy2.png 885w,
/static/66b7f12a21b38ee627f03bab64549b77/c83ae/policysim-iam-policy2.png 1180w,
/static/66b7f12a21b38ee627f03bab64549b77/d777c/policysim-iam-policy2.png 1555w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This role gives my AWS resource, in this case my AWS Config Recorder, the following AWS Managed permissions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Read-Only access to AWS Services and resources&lt;/li&gt;
&lt;li&gt;A Default Policy for the AWS Config service so that AWS Config can track changes across my acount.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The KMS Key is set up with the following permissions:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Id&quot;: &quot;key-consolepolicy-3&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Sid&quot;: &quot;Allow access for Key Administrators&quot;,
            *REDACTED*
        },
        {
            &quot;Sid&quot;: &quot;Allow Config to use this key&quot;,
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Principal&quot;: {
                &quot;Service&quot;: &quot;config.amazonaws.com&quot;
            },
            &quot;Action&quot;: &quot;kms:GenerateDataKey*&quot;,
            &quot;Resource&quot;: &quot;*&quot;,
            &quot;Condition&quot;: {
                &quot;ArnLike&quot;: {
                    &quot;aws:SourceArn&quot;: &quot;arn:aws:iam::**********:role/aws-controltower-ConfigRecorderRole&quot;
                }
            }
        }
    ]
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see that this key already has permissions to allow the above topic to run &lt;code class=&quot;language-text&quot;&gt;KMS:GenerateDataKey*&lt;/code&gt; using the key.&lt;/p&gt;
&lt;p&gt;Jumping back to the &lt;code class=&quot;language-text&quot;&gt;aws-controltower-ConfigReecorderRole&lt;/code&gt; on the AWS IAM Dashboard, you can see a button that says &lt;strong&gt;Simulate&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7de992dfda60d6a28dc68d50fa29ccbd/e405b/policysim-iam-policy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 20.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAtklEQVQY01VPuxKDMAzj/3+vQ5cOPbgrDSFA3jwCauQu7eCTLDuR3GRrkNwM5z1yztj3HTFGrOuKEIL013XhPE+pLy847IwSvWjHcUhx1phpxlspTNOElBK2bZNPuFBKEU5NdGLtg7Uw9xvs8wHvHMZxxDAMstMYY9C2LV59LyKLGg3IiSxVedd1ommtoWuIUf/v+nplw9P08EKrZsS8igs1Ip35gCmZvv8xpQHntqZdlkWQV30AE9cyeaEVrnwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Simualtor Button on IAM Role&quot;
        title=&quot;Simualtor Button on IAM Role&quot;
        src=&quot;/static/7de992dfda60d6a28dc68d50fa29ccbd/fcda8/policysim-iam-policy.png&quot;
        srcset=&quot;/static/7de992dfda60d6a28dc68d50fa29ccbd/12f09/policysim-iam-policy.png 148w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/e4a3f/policysim-iam-policy.png 295w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/fcda8/policysim-iam-policy.png 590w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/efc66/policysim-iam-policy.png 885w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/c83ae/policysim-iam-policy.png 1180w,
/static/7de992dfda60d6a28dc68d50fa29ccbd/e405b/policysim-iam-policy.png 1566w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;If you click this, it will take you to the IAM Policy Simulator. Alternatively, you can jump into the Policy Simulator from the IAM Dashboard here.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4d352effd2f7c9ff932c62669c0ae0c1/f470a/policysim-iam-dashboard.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABk0lEQVQoz3VQy24TQRD0H3KOgsQpEbmAyGdwIxEHEiQev8CVCCk3EuVFbOWwMjHGstee3dn17O48dman6Bkb5wAZqTTdperu6u5lOcdo/BsF55hxiZcfbvHqUz9i//MALz72sXt0jZ1313h+fIO99zd49vYKW28usH14he2DSzw9vMST12f4cj5Fr6kq1HUNZQHnAXQGgjOIggGtJCKQj73uH6ZX5Aw8Y7DWRkKKCuksRbognqB4gdZ1MK2NsBS7zlPcYr7IMOgnWC7ryLmuQ6+umxhg7cUqRQMyLIWA1hramPiHgc45eP/gePRzgtNvF6RxK7+hoaDCsig2QkXFnPLgIAgC/jYKTUNu1kOSZISTr99x2x9iOmWrlfMsB2Ns07DRFsrYOFXq4KpDLnRcSWoaQrpa6rjPkuqSH3cYDhLMx1P4ztEN6UZlWW7WkFIiI2HbmjXj//s768DTOcqqgXctvFHwslk1LMoirhDEilwMZwITVpEzumfdIq9MRBYgDBiBU1ymM4zv7zH5NSK3C3it8AcIglp1C5Iz4gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IAM Dashboard&quot;
        title=&quot;IAM Dashboard&quot;
        src=&quot;/static/4d352effd2f7c9ff932c62669c0ae0c1/fcda8/policysim-iam-dashboard.png&quot;
        srcset=&quot;/static/4d352effd2f7c9ff932c62669c0ae0c1/12f09/policysim-iam-dashboard.png 148w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/e4a3f/policysim-iam-dashboard.png 295w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/fcda8/policysim-iam-dashboard.png 590w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/efc66/policysim-iam-dashboard.png 885w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/c83ae/policysim-iam-dashboard.png 1180w,
/static/4d352effd2f7c9ff932c62669c0ae0c1/f470a/policysim-iam-dashboard.png 1443w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Once you are on the Policy Simulator Page, you can select&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The IAM User, Group or Role to use.&lt;/li&gt;
&lt;li&gt;The Service you need permission to.&lt;/li&gt;
&lt;li&gt;Specific Service actions you would like to use.&lt;/li&gt;
&lt;li&gt;Action settings -  you can provide resource ARN’s here.&lt;/li&gt;
&lt;li&gt;Run the Simulation&lt;/li&gt;
&lt;li&gt;View the Simulation results.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7adf31c59a21a08709be1442b5599eb9/d8c86/policysim-denied.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 29.054054054054056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCklEQVQY032Qu04DMRBF9+dBFKHLJ1BQEBGgRAJFfAASSDSU7CbZlzf2vh07B9soCMJjpNFobM/xvRPlWcYyEzw8v3H3mPD0mrFerYiXFX0/kBcNm02FlAprbcjdbkfbtpRCYLaatdTcvgwoDVEcx6TrFXWtGIcBqRqSZEma5SilHEy63FBVVejruqZpGvdZH+picc/scs7Z+Zz51TWR1iM+xq0NtRA9cZIinaqyLCmKIgxLKRFOkQfmeU7btYhUMLu4YTI55eT4iOl0SuQfdF0XrBhj0No4S4Teh7f3V5itu/dixtGtoHOcnsjb8cA9xFrzY9BDf8uPsN/efQL3C/cq/4N8hR2e+dl3KXXKjOyG9kUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;IAM Policy Simulator&quot;
        title=&quot;IAM Policy Simulator&quot;
        src=&quot;/static/7adf31c59a21a08709be1442b5599eb9/fcda8/policysim-denied.png&quot;
        srcset=&quot;/static/7adf31c59a21a08709be1442b5599eb9/12f09/policysim-denied.png 148w,
/static/7adf31c59a21a08709be1442b5599eb9/e4a3f/policysim-denied.png 295w,
/static/7adf31c59a21a08709be1442b5599eb9/fcda8/policysim-denied.png 590w,
/static/7adf31c59a21a08709be1442b5599eb9/efc66/policysim-denied.png 885w,
/static/7adf31c59a21a08709be1442b5599eb9/c83ae/policysim-denied.png 1180w,
/static/7adf31c59a21a08709be1442b5599eb9/d8c86/policysim-denied.png 1663w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;A simulaton has already been run in the above screenshot. You can see the &lt;code class=&quot;language-text&quot;&gt;Access Denied&lt;/code&gt; result with some additional information.&lt;/p&gt;
&lt;p&gt;Now I have enough information to create a custom IAM Policy I can attach to this role. I can also quickly test the custom policy on the role using the simulator.&lt;/p&gt;
&lt;p&gt;Here’s a result once the right policy has been attached.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/07a9c/policysim-success.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 28.37837837837838%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABCUlEQVQY05WPwU7DMBBE8///wg9w4sQJqUJI0BZaqbR146SJ7cZOmjjJw7YoB04w0mhs7+54NjuXBat9xf3iwOO6ZrkrEcc9pzynaRr6vudyuaCUoq5rvPfM8/x9V2it2Bxr7p4KHt4qsvf3NeKwx18tTB7rWoQQ5MGwqiqcc8lQa51MrLWJ0Tzq1VmcddTaoZuOTFYabQxKG0wTml2XzOJApJQSE+qRt/eosixRuy3y9ZkmqPvc0u8+yLqQIGGeYBzxw5DWbNuWIZy7rksa1xxD/aYRYxsCnAVtKXFFjjeKTL0sMOGXfrvCb5b4QvAXROPfCJHITrkkF0d8SDX5ISTsfwb+y2ka+QJdh8zEkv76FAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Policy Simulator Passed&quot;
        title=&quot;Policy Simulator Passed&quot;
        src=&quot;/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/fcda8/policysim-success.png&quot;
        srcset=&quot;/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/12f09/policysim-success.png 148w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/e4a3f/policysim-success.png 295w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/fcda8/policysim-success.png 590w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/efc66/policysim-success.png 885w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/c83ae/policysim-success.png 1180w,
/static/fc40b6c00a0bc0cb049d29cbecb2ef6c/07a9c/policysim-success.png 1440w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;IAM Policy Simulator allows you to quickly debug and test IAM Policies attached to IAM Users, Groups or Roles against specific AWS resources. It saves time spent in manual testing by making this action one-click with instant results and is highly customizable.&lt;/p&gt;
&lt;p&gt;Big thanks to Martin Caarels, you can check out his blog &lt;a href=&quot;https://blog.caarels.com&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item></channel></rss>